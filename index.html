<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Sopy – Cápsulas Lava Roupas | Aqua Blu & Citrus Lush</title>
    <meta name="description" content="Cápsulas superconcentradas que removem manchas, protegem as fibras e dissolvem 100%. Todas as máquinas e temperaturas." />

    <!-- Local fonts preload (Avant Garde .woff) -->
    <link rel="preload" href="assets/fonts/AVGARDD_2.woff" as="font" type="font/woff" crossorigin>
    <link rel="preload" href="assets/fonts/AVGARDN_2.woff" as="font" type="font/woff" crossorigin>
    <link rel="preload" href="assets/fonts/AVGARDDO_2.woff" as="font" type="font/woff" crossorigin>

  <!-- CSS do projeto -->
  <link rel="stylesheet" href="styles.css" />
  <!-- Inter Tight font for section titles -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter+Tight:wght@400;600;800;900&display=swap">

  <!-- Pré-carrega o vídeo principal para start mais rápido (mp4). Adicione também webm quando disponível. -->
  <link rel="preload" href="assets/videos/hero.mp4" as="video" type="video/mp4" />

  <!-- Ícone / Favicon (opcional) -->
    <link rel="icon" href="assets/favicon.png" type="image/png" />
  </head>

  <style>
    




.sopy-btn, .sopy-btn-primary, .sopy-btn-outline {
  letter-spacing: 0.02em;
  padding-left: 2.2em;
  padding-right: 2.2em;
}
/* -------------------------------------------------------
   SOPY â€“ styles.css
   Reset + Tokens + Layout + States para animaÃ§Ãµes GSAP
   (HTML: a estrutura que te enviei)
------------------------------------------------------- */

/* ========== RESET BÃSICO ========== */
*,
*::before,
*::after { box-sizing: border-box; }

html, body {
  min-height: 100%;
  scroll-behavior: auto; /* Lenis cuida do smooth */
}
/* Local fonts handled via @font-face below (Avant Garde) */

/* Local Avant Garde fonts (placed in assets/fonts/) */
@font-face {
  font-family: 'Avant Garde Demi BT';
  src: url('assets/fonts/AVGARDD_2.woff') format('woff');
  font-weight: 600;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'Avant Garde Book BT';
  src: url('assets/fonts/AVGARDN_2.woff') format('woff');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}
@font-face {
  font-family: 'Avant Garde Demi Oblique BT';
  src: url('assets/fonts/AVGARDDO_2.woff') format('woff');
  font-weight: 600;
  font-style: italic;
  font-display: swap;
}

/* Local display font: Dirtyline (placed in assets/fonts/) */
@font-face {
  font-family: 'Dirtyline';
  src: url('assets/fonts/Dirtyline 36daysoftype 2022.woff') format('woff');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}

body {
  margin: 0;
  /* Use Avant Garde Book (lighter) for body text */
  font-family: 'Avant Garde Book BT';
  color: var(--text);
  background: #0D1B2A; /* match FAQ section background to avoid white behind footer */
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
}

/* Bloqueia scroll durante o loading */
body.is-loading {
  overflow: hidden;
  height: 100vh;
}

/* Links e botÃµes */
a { color: inherit; text-decoration: none; }
button { font: inherit; color: inherit; background: none; border: none; cursor: pointer; }
img, video { display: block; max-width: 100%; }

/* Acessibilidade */
:focus-visible { outline: 2px solid var(--brand); outline-offset: 2px; }

/* interactive elements keep their default cursors (no global custom cursor) */

/* ========== TOKENS DE TEMA ========== */
:root {
  /* Neutros */
  --bg: #ffffff;
  --surface: #f6f7fb;
  --surface-2: #eef1f6;
  --text: #0e0f12;
  --muted: #ffffff; /* agora branco para melhor contraste conforme pedido */
  --line: #e5e7eb;
  --shadow: 0 10px 25px rgba(0,0,0,.12);

  /* Aqua Blu (default) â€” palette: #083DA6, #076DF2, #0C87F2, #1DDDF2 */
  --brand: #076DF2;       /* primary */
  --brand-2: #0C87F2;     /* secondary */
  --accent: #1DDDF2;      /* accent */
  --brand-dark: #083DA6;  /* dark */
  --gradient: radial-gradient(1200px 600px at 70% 30%, rgba(7,109,242,.18), transparent),
              radial-gradient(800px 400px at 20% 80%, rgba(29,221,242,.18), transparent);
  /* Water seam controls */
  --mask-start: 52%;   /* onde comeÃ§a a desvanecer o vÃ­deo (45â€“60%) */
  --seam-height: 22vh; /* altura da zona de mistura (15â€“30vh) */
}

body.theme-citrus {
  /* Citrus Lush â€” palette: #5FD97E, #91D9A3, #167312, #D7D9D2 */
  --brand: #5FD97E;       /* primary */
  --brand-2: #91D9A3;     /* secondary */
  --accent: #D7D9D2;      /* accent/neutral */
  --brand-dark: #167312;  /* dark */
  --gradient: radial-gradient(1200px 600px at 70% 30%, rgba(95,217,126,.18), transparent),
              radial-gradient(800px 400px at 20% 80%, rgba(145,217,163,.18), transparent);
}

/* Tipos */
/* Headings use Inter Tight for a tighter display; fallback to Avant Garde Demi */
h1, h2, h3, h4, h5, h6 { font-family: 'Inter Tight', 'Avant Garde Demi BT', sans-serif; font-weight: 600; letter-spacing: 0; }
/* Stronger display for H2 specifically */
h2 {
  text-transform: uppercase;
  font-size: clamp(2.75rem, 6vw, 5rem);
  line-height: 1.02;
  letter-spacing: 0.02em;
}
/* H3 slightly larger but not uppercase */
h3 {
  font-size: clamp(1.4rem, 2.4vw, 2rem);
}
h1 { font-size: clamp(2.25rem, 6vw, 4rem); line-height: 1.02; margin: 0 0 0.5rem; }
h2 { font-size: clamp(1.75rem, 3.6vw, 2.5rem); line-height: 1.06; margin: 0 0 .5rem; }
h3 { font-size: clamp(1.25rem, 2.4vw, 1.4rem); margin: 0; }
p  { font-size: clamp(1rem, 1.3vw, 1.06rem); line-height: 1.55; color: var(--text); margin: 0; }
.muted { color: var(--muted); font-size: 1.03rem; line-height: 1.6; }

/* ========== GRID & SEÃ‡Ã•ES ========== */
.section { 
  padding: clamp(56px, 8vw, 96px) clamp(16px, 5vw, 64px); 
  position: relative; 
  min-height: 100vh; /* volta para 100vh */
  display: flex; 
  flex-direction: column; 
  justify-content: center; /* centraliza verticalmente o conteÃºdo */
  z-index: 3; /* garante que seÃ§Ãµes apÃ³s o hero cubram o vÃ­deo sticky */
}
.section--full { 
  height: 100vh; /* volta para 100vh */
  position: relative; 
  overflow: visible; /* nÃ£o clipe para permitir sticky e sobreposiÃ§Ã£o */
  display: flex; 
  align-items: center; 
  justify-content: center; /* centraliza conteÃºdo */
}

/* Benefícios - big 2x2 cards */
#beneficios {
  padding: 40px 24px;
  min-height: 180vh; /* aumentar a altura da seção */
}

/* Make the section title for Benefícios very large, left-aligned and bold */
#beneficios .section-header {
  /* move the header off-center visually */
  text-align: left;
  max-width: none; /* allow wide heading */
  margin-left: clamp(16px, 6vw, 96px);
  margin-bottom: 1.25rem;
}
#beneficios .section-header h2 {
  color: #ffffff;
  /* slightly reduced size to match card scale */
  font-size: clamp(3.2rem, 8.5vw, 6.8rem);
  font-weight: 900;
  margin: 0 0 0.6rem 0;
  line-height: 0.95;
  letter-spacing: 0;
}
#beneficios .section-header p {
  color: var(--muted);
  text-align: left;
  margin-left: 0;
}

@media (max-width: 900px) {
  /* on small screens keep it centered and smaller to avoid overflow */
  #beneficios .section-header { text-align: center; margin-left: 0; }
  #beneficios .section-header h2 { font-size: clamp(2rem, 10vw, 3.4rem); line-height: 1.04; }
  #beneficios .section-header p { text-align: center; }
}
.benefit-grid.big-cards {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: 1fr 1fr;
  gap: 36px; /* larger gap to match sketch spacing */
  width: min(1300px, 96%);
  margin: 0 auto;
}

/* ====== SplitText helpers (Osmo style) ====== */
/* Estilos para animações Osmo */
.split-line, 
.split-word, 
.split-char {
  overflow: hidden !important;
  display: inline-block !important;
  vertical-align: top;
  position: relative;
}

.split-line > span, 
.split-word > span, 
.split-char > span {
  display: inline-block !important;
  will-change: transform;
  /* REMOVIDO: transform: translateY(110%) !important; - isso vai ser definido pelo GSAP */
}

/* Fix para parágrafos */
p .split-word {
  margin-right: 0.25em;
}

/* Evitar problemas de alinhamento */
h1 .split-line, 
h2 .split-line, 
h3 .split-line {
  width: 100%;
  display: block;
}

/* Classes adicionais para garantir visibilidade do efeito */
[data-split-type] {
  overflow: hidden !important;
}

/* Força o mascaramento para elementos que foram splitados */
h1[class*="split"], h2[class*="split"], h3[class*="split"], 
p[class*="split"], .section-header[class*="split"] {
  overflow: visible !important; /* permite que as linhas internas sejam mascaradas individualmente */
}
.card-large {
  position: relative;
  background: #fff; /* white surface like the sketch */
  border-radius: 28px;
  padding: 28px;
  overflow: visible;
  min-height: 420px; /* increased height to match the larger cards in the image */
  display: block;
}
.card-large .card-svg {
  position: absolute;
  left: 28px;
  top: 28px;
  width: 150px; /* bigger icon to match sketch */
  height: 150px;
  opacity: 1;
}
.card-large .card-svg img { width: 100%; height: 100%; object-fit: contain; }
.card-large .benefit-title {
  position: absolute;
  right: 28px;
  bottom: 28px;
  font-size: clamp(1rem, 2.2vw, 1.4rem); /* slightly larger title for visual balance */
  max-width: 50%;
  text-align: right;
  color: var(--text);
  font-weight: 700;
}

/* add subtle outline like the sketch (dark border) for stronger visual matching */
.benefit-grid.big-cards .card-large {
  border: 6px solid rgba(0,0,0,0.95); /* thicker outline to mimic sketch */
}

/* Replacement card styles from the user's sample (scoped under #beneficios) */
#beneficios .cards-container {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  gap: 30px;
  padding: 60px 20px;
  width: 90%;
  max-width: 1700px;
  margin: 0 auto;
}

#beneficios .column {
  display: flex;
  flex-direction: column;
  gap: 30px;
  flex: 1;
}

#beneficios .column:nth-child(2) { margin-top: 120px; }

#beneficios .card {
  background-color: rgba(255,255,255,0.04);
  border-radius: 20px;
  padding: 50px;
  height: 360px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.06);
}

#beneficios .card-content { position: relative; z-index: 2; display:flex; flex-direction: column; justify-content: space-between; height:100%; }

#beneficios .card-number { font-size: 5rem; font-weight: 500; color: var(--muted); }

#beneficios .card-label { font-size: 1rem; font-weight: 500; color: #d1d1d1; align-self: flex-end; text-transform: uppercase; }

#beneficios .card-blob {
  background-color: white;
  height: 400px;
  width: 400px;
  border-radius: 50%;
  position: absolute;
  z-index: 1;
  filter: blur(120px);
  opacity: 0;
  transition: opacity 0.3s ease-in-out;
  pointer-events: none;
}

#beneficios .card:hover .card-blob { opacity: 0.7; }

#beneficios .column:nth-child(1) .card:nth-child(1) .card-blob { background-color: #e84a4a; }
#beneficios .column:nth-child(1) .card:nth-child(2) .card-blob { background-color: #4a86e8; }
#beneficios .column:nth-child(2) .card:nth-child(1) .card-blob { background-color: #4ae8a4; }
#beneficios .column:nth-child(2) .card:nth-child(2) .card-blob { background-color: #e8c54a; }

@media (max-width: 768px) {
  #beneficios .cards-container { flex-direction: column; align-items: center; width: 90%; }
  #beneficios .column:nth-child(2) { margin-top: 0; }
  #beneficios .column { width: 100%; }
}

/* ===================== New SVG sizing & theme-aware color for beneficios cards ===================== */
#beneficios .card-icon {
  width: clamp(64px, 8vw, 140px); /* larger icons that scale with viewport */
  height: auto; /* preserve svg aspect */
  display: block;
  margin-bottom: 18px;
  stroke: currentColor; /* inherit from color property */
  fill: none; /* keep stroke style unless explicit fill needed */
}

/* allow customizing icon color via a CSS variable so themes can override easily */
#beneficios .card {
  --icon: var(--brand);
  color: var(--icon); /* SVG stroke uses currentColor */
}

/* theme overrides for icon color to ensure contrast across themes */
body.theme-citrus #beneficios .card { --icon: var(--brand-dark); }
body.theme-aqua #beneficios .card { --icon: var(--brand); }

/* Ensure titles and labels have good contrast when icons change */
#beneficios .card-title { color: #fff; font-size: 1.25rem; margin: 0 0 8px 0; }
#beneficios .card-label { color: rgba(255,255,255,0.85); font-weight: 700; letter-spacing: .08em; }

/* Make sure the blob stays behind content and doesn't cover the icon area on large screens */
#beneficios .card-blob { transform: translate(40%, -10%); }

@media (max-width: 900px) {
  #beneficios .card { padding: 32px; height: auto; }
  #beneficios .card-icon { width: 72px; margin-bottom: 12px; }
}



  /* Ensure the hero remains highest visually so video looks correct */
  #hero { z-index: 2; }
  /* other sections slightly lower so overlap order is predictable */
  .section { z-index: 1; }

.section-header { max-width: 900px; margin: 0 auto 2.25rem; text-align: center; }
.section-header p { color: var(--muted); font-size: 1.05rem; line-height: 1.6; }

.howto-header {
  text-align: center;
  margin: 0 0 2.5rem 0;
  padding: 0;
  background: transparent; /* remove fundo separado */
}
.howto-header h2 {
  color: #fff;
  font-family: 'Avant Garde Demi BT', 'Syne', sans-serif;
  /* Font um pouco menor que benefícios */
  font-size: clamp(3rem, 8vw, 6rem);
  font-weight: 900;
  margin: 0;
  line-height: 0.95;
  letter-spacing: 0;
}
/* transiÃ§Ã£o suave para o header aparecer/sumir */
.site-header { 
  transition: opacity .25s ease, transform .25s ease, background .25s ease;
  position: fixed;
  left: 0; right: 0; top: 0;
  z-index: 1200; /* stay above most content */
  background: transparent; /* transparent by default so hero shows through */
  padding: 12px 0; /* vertical spacing for the header */
  will-change: transform, opacity, background;
}

/* Hide the header when JS toggles body.nav-hidden (scrolling down) */
body.nav-hidden .site-header {
  transform: translateY(-16px);
  opacity: 0;
  pointer-events: none;
}

.nav {
  width: min(1400px, 94%);
  margin: 0 auto; /* center the nav container inside the fixed header */
  padding: 0 24px; /* lateral padding inside the container */
  display: flex;
  align-items: center;
  justify-content: space-between; /* logo left, CTA right */
  gap: 16px;
  height: 56px; /* consistent header height for layout */
}
.nav-logo img { height: 38px; width: auto; display: block; }
.nav-logo { align-self: center; }

.nav-cta { display: flex; align-items: center; justify-self: end; }

/* If navigation links are added later, keep them centered (fallback) */
.nav-links { display: flex; gap: 20px; justify-content: center; align-items: center; }
.nav-links a { color: var(--text); font-weight: 500; font-size: .95rem; opacity: .85; transition: opacity .2s ease; }
.nav-links a:hover { opacity: 1; }

/* ========== BOTÃ•ES SOPY ========== */
.sopy-btn {
  --_bg: var(--brand);
  --_fg: #fff;
  --_bd: var(--brand);
  position: relative;
  display: inline-flex; align-items: center; justify-content: center;
  gap: .5rem; padding: .85rem 1.8rem; border-radius: 999rem;
  border: 1px solid var(--_bd); background: var(--_bg); color: var(--_fg);
  font-weight: 600; letter-spacing: .05em; box-shadow: none; 
  transition: transform .12s ease, background .2s ease, box-shadow .2s ease, color .2s ease, border-color .2s ease;
  overflow: hidden;
}

.sopy-btn::before {
  content: "";
  position: absolute;
  left: var(--xPos, 50%);
  top: var(--yPos, 50%);
  transform: translate(-50%, -50%);
  width: 0;
  height: 0;
  background-color: rgba(255, 255, 255, 0.15);
  border-radius: 50%;
  transition: width 1.5s ease, height 1.5s ease;
  z-index: 0;
}

.sopy-btn:hover::before {
  width: 400px;
  height: 400px;
}

.sopy-btn * {
  position: relative;
  z-index: 1;
}

.sopy-btn:hover { transform: translateY(-1px); box-shadow: 0 10px 18px rgba(0,0,0,.08); }
.sopy-btn:active { transform: translateY(0); box-shadow: none; }

.sopy-btn-ghost {
  --_bg: rgba(255,255,255,.7);
  --_fg: var(--brand);
  --_bd: rgba(0,0,0,0);
}
.sopy-btn-outline {
  --_bg: transparent;
  --_fg: var(--brand);
  --_bd: var(--brand);
}

/* ========== HERO (VÃDEO) ========== */
.hero, #hero {
  display: flex;
  flex-direction: column;
  /* Use small viewport units and include safe-area to avoid notch overlap */
  min-height: 100svh;
  padding-top: calc(clamp(96px, 16vh, 200px) + env(safe-area-inset-top)); /* mais espaço acima */
  justify-content: flex-start; /* alinha o conteúdo para o topo */
}

.hero-media {
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  background: var(--gradient);
}
.hero-video {
  position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;
  filter: saturate(105%) contrast(102%);
  mix-blend-mode: normal;
  -webkit-mask-image:
    linear-gradient(to bottom,
      #000 0%,
      #000 var(--mask-start),
      rgba(0,0,0,.98) calc(var(--mask-start) + 4%),
      rgba(0,0,0,.90) calc(var(--mask-start) + 9%),
      rgba(0,0,0,.75) calc(var(--mask-start) + 15%),
      rgba(0,0,0,.55) calc(var(--mask-start) + 22%),
      rgba(0,0,0,.35) calc(var(--mask-start) + 29%),
      rgba(0,0,0,.18) calc(var(--mask-start) + 35%),
      rgba(0,0,0,0) 100%
    );
          mask-image:
    linear-gradient(to bottom,
      #000 0%,
      #000 var(--mask-start),
      rgba(0,0,0,.98) calc(var(--mask-start) + 4%),
      rgba(0,0,0,.90) calc(var(--mask-start) + 9%),
      rgba(0,0,0,.75) calc(var(--mask-start) + 15%),
      rgba(0,0,0,.55) calc(var(--mask-start) + 22%),
      rgba(0,0,0,.35) calc(var(--mask-start) + 29%),
      rgba(0,0,0,.18) calc(var(--mask-start) + 35%),
      rgba(0,0,0,0) 100%
    );
}
.hero-poster {
  position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover;
  opacity: 1; transition: opacity .35s ease;
}
.hero-poster.is-hidden { opacity: 0; }
.hero-content {
  position: relative; z-index: 1; width: min(1100px, 92%);
  margin: 0 auto; padding: 0 0 0;
  display: grid; gap: clamp(12px, 1.8vw, 18px); justify-items: center; text-align: center;
}
.hero-content h1 {
  color: var(--brand-dark);
  text-shadow: 0 2px 12px rgba(0,0,0,.28);
  /* Large on desktop, scales down fluidly on smaller screens */
  font-size: clamp(2.6rem, 10vw, 5.5rem);
  line-height: 1.02;
  letter-spacing: -0.005em;
  text-wrap: balance;
}
.hero-content p { max-width: 780px; color: #ffffff; text-shadow: 0 2px 10px rgba(0,0,0,.25); }
.hero section, .hero { color: #fff; }
.hero .sopy-btn-primary { background: #fff; color: var(--brand); border-color: #fff; }
.hero-ctas { display: flex; gap: 12px; flex-wrap: wrap; }

/* Espuma/seam sutil entre hero e seÃ§Ã£o seguinte */
#hero::after {
  content: "";
  position: absolute; left: 0; right: 0; bottom: calc(-1 * var(--seam-height) * 0.5); height: var(--seam-height);
  background: radial-gradient(140% 110% at 50% 0%, rgba(255,255,255,.9) 0 34%, rgba(255,255,255,0) 60%);
  filter: blur(8px);
  opacity: .25;
  pointer-events: none;
}

/* ========== LOADER ========== */
#loader {
  position: fixed; inset: 0; z-index: 1000; background: transparent; /* fundo vem do ::before mascarado */
  color: #fff; display: grid; place-items: center; pointer-events: none;
}
/* MÃ¡scara tipo "gota": cria um furo circular que revela o vÃ­deo ao fundo */
#loader {
  /* variÃ¡veis controladas via JS/GSAP */
  --r: 0px;      /* raio da gota */
  --cx: 50vw;    /* centro X */
  --cy: 50vh;    /* centro Y */
}

#loader::before {
  content: "";
  position: fixed;
  inset: 0;
  z-index: 0; /* fica atrÃ¡s do conteÃºdo do loader */
  background: var(--brand-dark);
  /* Dentro do raio -> transparente (revela o vÃ­deo); fora -> sÃ³lido (escuro) */
  -webkit-mask: radial-gradient(circle at var(--cx) var(--cy), transparent 0 var(--r), black calc(var(--r) + 1px) 100%);
  mask: radial-gradient(circle at var(--cx) var(--cy), transparent 0 var(--r), black calc(var(--r) + 1px) 100%);
  pointer-events: none;
}
.loader-overlay {
  position: absolute; inset: 0; display: none; grid-template-columns: 1fr 1fr; z-index: 1;
}
.loader-block { background: rgba(255,255,255,.06); }
.loader-center { position: relative; z-index: 2; display: grid; place-items: center; gap: 18px; }

.loader-counter { 
  font-family: 'Syne', Inter, sans-serif; font-weight: 700;
  font-size: clamp(2.25rem, 10vw, 8rem); line-height: 1; letter-spacing: -0.02em;
}

/* Remove a linha vertical do loader */
.loader-divider { display: none; }

.loader-circle {
  width: 240px; aspect-ratio: 1; border-radius: 50%;
  border: 2px solid rgba(255,255,255,.35);
  box-shadow: inset 0 0 80px rgba(255,255,255,.06), 0 10px 30px rgba(0,0,0,.2);
  transform: scale(0); /* nÃ£o usamos mais para o reveal, sÃ³ efeito visual se quiser */
  display: none; /* oculto para evitar segundo cÃ­rculo visÃ­vel */
}

/* custom cursor removed to use default system cursor */

/* ========== 3D (CAPSULE PIN) ========== */
.capsule3d { background: var(--surface); }
#capsula-3d { height: 200vh; --capsule-ui-offset: 120px; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 0; position: relative; z-index: 2; isolation: isolate; }
#capsula-3d::before {
  /* zona de mistura suave no topo e gradiente profundo */
  content: "";
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  background:
    linear-gradient(to bottom,
      #a6d1df 0%,  /* azul claro da superfÃ­cie */
      #6fb8c4 38%,
      #2a7f95 80%,
      #166277 100%);
}
#capsula-3d::after {
  /* bolhinhas discretas na seÃ§Ã£o deep (sob o canvas) */
  content: "";
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  background-image: radial-gradient(circle at 30% 75%, rgba(255,255,255,.22) 0 1px, transparent 2px);
  background-size: 240px 240px;
  opacity: .18;
  animation: bubbles 28s linear infinite;
}
#capsula-3d::before {
  content: "";
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  background:
    linear-gradient(to bottom,
      #a6d1df 0%,
      #6fb8c4 38%,
      #2a7f95 80%,
      #166277 100%);
}
#capsula-3d::after {
  content: "";
  position: absolute; left: 0; right: 0; top: -2vh;
  height: calc(var(--seam-height) + 8vh);
  background: linear-gradient(to top,
    rgba(166,209,223,.92) 0%,
    rgba(166,209,223,.65) 35%,
    rgba(166,209,223,.35) 65%,
    rgba(166,209,223,0) 100%);
  mix-blend-mode: soft-light;
  filter: blur(10px);
  pointer-events: none;
}
#three-container {
  position: sticky; top: var(--capsule-ui-offset); width: 100%; height: calc(100vh - var(--capsule-ui-offset));
  background: transparent;
  display: flex; align-items: center; justify-content: center;
  z-index: 3;
}
.capsule3d::before {
  /* bolhinhas discretas na seÃ§Ã£o deep (sob o canvas) */
  content: "";
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  background-image: radial-gradient(circle at 30% 75%, rgba(255,255,255,.22) 0 1px, transparent 2px);
  background-size: 240px 240px;
  opacity: .18;
  animation: bubbles 28s linear infinite;
}
.capsule3d-ui {
  /* Make the UI static so titles and copy don't pin or move with scroll */
  position: relative; /* normal document flow */
  width: min(1200px, 94%); margin: 0 auto; padding: 16px 0;
  display: grid; grid-template-columns: 1fr; gap: 10px; align-items: center; justify-items: center;
  text-align: center;
  padding-top: 3.5rem;
  z-index: 2;
  order: -1; /* keeps UI before the canvas in column direction */
}
.capsule3d-title-over {
  position: absolute;              /* fixed inside the #capsula-3d container */
  top: 65vh;                       /* higher position without sticking */
  left: 50%;
  transform: translateX(-50%);     /* center horizontally */
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2;                      /* below CTA (z:4) and canvas (z:3) if desired */
  pointer-events: none;
}
.capsule3d-title-over h2 {
  color: #ffffff;
  text-align: center;
  font-weight: 900;
  letter-spacing: 0;
  font-size: clamp(2.2rem, 6vw, 6rem); /* slightly smaller */
  line-height: 0.98;
  margin: 0;
}
.capsule-3d-cta {
  position: absolute; /* fixed position within section */
  bottom: 30vh; /* align with 3D object height */
  right: clamp(24px, 8vw, 14vw); /* default position on right */
  transform: translateY(0) scale(1);
  max-width: 420px;
  z-index: 4; /* above title */
  pointer-events: none;
  opacity: 0; /* shown near the end via class */
  visibility: hidden;
  transition: opacity .45s cubic-bezier(.22,.9,.25,1), transform .45s cubic-bezier(.22,.9,.25,1), visibility .45s, left .6s ease, right .6s ease;
}

/* Theme-based positioning */
body.theme-citrus .capsule-3d-cta {
  right: auto;
  left: clamp(24px, 8vw, 14vw); /* move to left for citrus theme */
}

body.theme-aqua .capsule-3d-cta {
  left: auto;
  right: clamp(24px, 8vw, 14vw); /* stay on right for aqua theme */
}
.capsule-3d-cta-inner {
  background: rgba(255,255,255,0.1); /* glassmorphism background */
  padding: 24px 28px; 
  border-radius: 16px; 
  border: 1px solid rgba(255,255,255,0.2);
  box-shadow: 0 8px 32px rgba(0,0,0,0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  pointer-events: auto;
}
.capsule-3d-cta .product-title { 
  font-size: 1.2rem; 
  margin: 0 0 4px 0; 
  font-weight: 700;
  color: #ffffff; /* white text for glassmorphism */
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.capsule-3d-cta .product-price { 
  font-size: 1.8rem; 
  margin: 0 0 2px 0; 
  font-weight: 700;
  color: #ffffff; /* white text for glassmorphism */
}
.capsule-3d-cta .product-vat { 
  font-size: 0.8rem; 
  margin: 0 0 16px 0; 
  color: rgba(255,255,255,0.8); /* semi-transparent white */
  font-weight: 400;
}
.capsule-3d-cta .product-copy { 
  margin: 0 0 20px 0; 
  color: rgba(255,255,255,0.9); /* semi-transparent white */
  font-size: 0.9rem; 
  line-height: 1.4;
}
.capsule-3d-cta .sopy-product-cta { 
  width: 100%;
  background: rgba(255,255,255,0.2);
  color: #ffffff;
  border: 2px solid rgba(255,255,255,0.3);
  padding: 12px 24px;
  border-radius: 50px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.9rem;
  backdrop-filter: blur(5px);
  transition: all 0.3s ease;
}
.capsule-3d-cta .sopy-product-cta:hover {
  background: rgba(255,255,255,0.3);
  border-color: rgba(255,255,255,0.5);
}
.capsule-3d-cta .product-copy { margin: 0 0 1.1rem; color: var(--muted); font-size: 1.06rem; line-height: 1.6; }
.capsule-3d-cta .sopy-product-cta { display: inline-block; pointer-events: auto; }
.capsule-3d-cta.is-visible { opacity: 1; visibility: visible; }

@media (max-width: 900px) {
  .capsule-3d-cta { position: absolute; bottom: 15vh; right: 5vw; max-width: 340px; transform: none; }
  
  body.theme-citrus .capsule-3d-cta {
    right: auto;
    left: 5vw;
  }
  
  body.theme-aqua .capsule-3d-cta {
    left: auto;
    right: 5vw;
  }
  
  .capsule-3d-cta-inner { border-radius: 12px; padding: 20px; }
}
/* Quando visível, o CTA pode receber eventos do ponteiro */
.capsule-3d-cta.is-visible { pointer-events: auto; }

/* Limita o deslocamento direito para evitar overflow em telas muito pequenas */
@media (max-width: 480px) {
  .capsule-3d-cta.at-end {
    position: absolute;
    bottom: 15vh;
    right: 5vw;
    margin-right: 0;
    transform: none;
    pointer-events: auto;
    z-index: 5;
  }
  
  body.theme-citrus .capsule-3d-cta.at-end {
    right: auto;
    left: 5vw;
  }
}

@media (max-width: 900px) {
  .capsule-3d-cta.at-end { right: 8vw; bottom: 4.5rem; max-width: 360px; }
}
.capsule3d-copy p { color: var(--muted); max-width: 680px; margin: 0 auto; font-size: 1.05rem; line-height: 1.6; }

/* ==== Decorative bubbles inside the 3D section ====
   Bubbles rise from the 3D area upward toward the hero. JS will inject
   bubble elements into `.capsule-bubbles` and animate them with GSAP.
*/
.capsule-bubbles {
  position: absolute;
  inset: 0;
  pointer-events: auto; /* habilita cliques para explodir bolhas 3D */
  overflow: visible;
  z-index: 3; /* under CTA (60) and header (50), above background */
}
.capsule-bubbles .bubble {
  position: absolute;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  background: radial-gradient(circle at 35% 30%, rgba(255,255,255,0.85), rgba(255,255,255,0.15));
  box-shadow: 0 8px 24px rgba(0,0,0,0.12), inset 0 2px 8px rgba(255,255,255,0.12);
  opacity: 0.9;
  mix-blend-mode: screen;
  transform: translate3d(0,0,0) scale(0.9);
}
.capsule-bubbles .bubble.small { width: 28px; height: 28px; opacity: 0.8; }
.capsule-bubbles .bubble.large { width: 78px; height: 78px; opacity: 0.6; }

@media (max-width: 900px) {
  .capsule-bubbles .bubble { width: 34px; height: 34px; }
}

/* --- Toggle Animado de Produtos --- */
.product-toggle-container {
    text-align: center;
    margin: 0 auto 24px auto;
}

/* Posicionamento flutuante igual ao antigo fragrance-toggle */
.product-toggle-container {
  position: fixed;
  right: 18px;
  bottom: 18px;
  z-index: 80;
  padding: 8px;
}
.pod-toggle-checkbox {
    display: none;
}
.pod-toggle-label {
    display: inline-block;
    width: 120px; /* smaller */
    height: 60px; /* smaller */
    border-radius: 36px;
    position: relative;
    cursor: pointer;
    box-shadow: inset 0 3px 8px rgba(0, 0, 0, 0.08), 0 1px 4px rgba(255, 255, 255, 0.45);
    background-color: #5cb85c;
    border: 4px solid #449d44;
    transition: background-color 0.35s cubic-bezier(.2,.8,.2,1), border-color 0.35s cubic-bezier(.2,.8,.2,1);
}
.pod-toggle-handle {
  position: absolute;
  /* vertically center the handle inside the label */
  top: 50%;
  left: 6px;
  width: 48px; /* smaller */
  height: 48px; /* smaller */
  background-color: #fff;
  border-radius: 50%;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.16);
  --tx: 0px;
  transform: translate(var(--tx), -50%);
  transition: transform 0.6s cubic-bezier(.2,.8,.2,1), box-shadow 0.25s ease;
  will-change: transform;
  overflow: hidden;
}
.pod-image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
}
.pod-image {
  position: absolute;
  width: 130%;
  height: 130%;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: contain;
  transition: opacity 0.45s cubic-bezier(.2,.8,.2,1);
}
.pod-image.green { opacity: 1; }
.pod-image.blue { opacity: 0; }
.pod-toggle-checkbox:checked + .pod-toggle-label .pod-toggle-handle {
  /* move the handle to the right while preserving vertical centering */
  --tx: 56px; /* adjusted for smaller label */
  transform: translate(56px, -50%); /* set explicit transform to ensure smooth animation across browsers */
}
.pod-toggle-checkbox:checked + .pod-toggle-label {
    background-color: #007bff;
    border-color: #0056b3;
}
.pod-toggle-checkbox:checked + .pod-toggle-label .pod-image.green {
    opacity: 0;
}
.pod-toggle-checkbox:checked + .pod-toggle-label .pod-image.blue {
    opacity: 1;
}

/* ========== BENEFÃCIOS ========== */
.benefit-grid {
  display: grid; grid-template-columns: repeat(6, minmax(0,1fr));
  gap: clamp(12px, 2vw, 20px); align-items: stretch;
}
.benefit-item {
  background: #fff; border: 1px solid var(--line); border-radius: 16px;
  padding: clamp(14px, 2.2vw, 18px); display: grid; gap: 10px; text-align: center;
  box-shadow: 0 4px 16px rgba(0,0,0,.04);
}
.benefit-item img { width: 40px; height: 40px; margin: 0 auto .25rem; filter: drop-shadow(0 4px 6px rgba(0,0,0,.06)); }
.benefit-item h3 { font-size: .98rem; color: var(--text); }

/* ========== COMO USAR (Horizontal Scroll) ========== */
.horizontal-scroll-section {
  height: 100vh;            /* ocupa toda a viewport */
  position: relative;
  overflow: hidden;
  background-color: var(--brand-dark);
  padding: 0;               /* sem padding para centralizar perfeitamente */
}

.how-title { display: none; }
/* Hide mobile slider by default (desktop) */
.cu-stack{ display:none; }

.horizontal-track {
  display: flex;
  position: relative; /* GSAP pinna a seção, não o track */
  height: 100vh;      /* ocupa toda a viewport conforme solicitado */
  will-change: transform; /* performance */
}

.background-text {
  position: absolute;
  inset: 0;
  display: grid; place-items: center;
  font-size: 18vw;
  text-align: center;
  color: rgba(255,255,255,0.35);
  font-weight: 800;
  z-index: 1; /* por trás do card */
  pointer-events: none;
}

.panel {
  flex: 0 0 100vw;   /* cada painel ocupa 100% da largura da viewport */
  height: 100vh;     /* cada painel usa a altura inteira da viewport */
  display: flex;
  justify-content: center;
  align-items: center; 
  padding: 0 10%;
  box-sizing: border-box;
  position: relative;
  z-index: 2;
}

@media (max-width: 768px){
  .horizontal-track{ height: 78vh; }
}

/* todos os painéis centralizados verticalmente, sem offsets */
.panel:nth-child(2),
.panel:nth-child(3),
.panel:nth-child(4) { align-self: center; padding: 0; }

.panel-content {
  /* Glassmorphism: translucent surface with blur */
  background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 28px;
  padding: 40px 40px 70px 40px;
  max-width: 520px;             /* um pouco mais largo, como na referência */
  min-height: 200px;
  box-sizing: border-box;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  color: var(--muted);
  box-shadow: 0 12px 32px rgba(0,0,0,0.28), inset 0 1px 0 rgba(255,255,255,0.02);
  transition: transform .28s cubic-bezier(.2,.9,.25,1), box-shadow .28s cubic-bezier(.2,.9,.25,1);
  margin: 0 auto;                /* centraliza no painel */
}

@supports ((-webkit-backdrop-filter: blur(0)) or (backdrop-filter: blur(0))) {
  .panel-content {
    -webkit-backdrop-filter: blur(8px) saturate(1.06);
    backdrop-filter: blur(8px) saturate(1.06);
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid rgba(255,255,255,0.12);
  }
}

/* Slight hover lift for desktop to emphasize glass cards */
.panel-content:hover {
  transform: translateY(-6px);
  box-shadow: 0 20px 48px rgba(0,0,0,0.36), inset 0 1px 0 rgba(255,255,255,0.02);
}

/* Theme tweaks so glass reads well on both brand backgrounds */
body.theme-citrus .panel-content,
body.theme-aqua .panel-content {
  /* on strong brand backgrounds, keep the glass slightly lighter */
  background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  border: 1px solid rgba(255,255,255,0.12);
  color: var(--muted);
}

.panel-number {
  background-color: var(--brand);
  color: #fff;
  border: 2px solid rgba(255, 255, 255, 0.9);
  box-sizing: border-box;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 700;
  margin-bottom: 25px;
  flex-shrink: 0;
}

.panel-content p {
  margin: 0;
  font-size: 1.05rem;
  line-height: 1.6;
  font-weight: 500;
  color: #fff;
}

.progress-bar {
  position: fixed;
  left: 50%;
  bottom: 32px;                 /* como a referência sugere */
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 14px;
  z-index: 50;
  width: auto;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.34s cubic-bezier(.22,1,.36,1);
}

.progress-bar.visible {
  opacity: 1;
  pointer-events: auto;
}

.progress-dot {
  width: 36px;
  height: 36px;
  background-color: rgba(255, 255, 255, 0.18);
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.26);
  transition: transform .2s ease, background-color .2s ease, border-color .2s ease, filter .2s ease;
  background-repeat: no-repeat;
  background-position: center;
  background-size: 18px 18px;
}
.progress-dot {
  width: 10px;
  height: 10px;
  background-color: rgba(255, 255, 255, 0.4); /* dots discretos */
  border-radius: 50%;
  transition: width .25s cubic-bezier(0.175, 0.885, 0.32, 1.275),
              height .25s cubic-bezier(0.175, 0.885, 0.32, 1.275),
              background-color .25s ease, transform .2s ease;
}

.progress-dot.active { background-color: rgba(255,255,255,0.28); border-color: transparent; transform: translateY(-2px); filter: drop-shadow(0 4px 10px rgba(0,0,0,.25)); }
.progress-dot.active {
  width: 56px;           /* pílula longa */
  height: 12px;
  border-radius: 999px;
  background-color: #F8C537; /* amarelo destaque */
  transform: translateY(-1px);
}

/* Ícones dos passos (ajuste os SVGs conforme quiser) */
/* dots sem ícones (apenas pílula no ativo) */

/* ========== VÃDEO SECUNDÃRIO ========== */
.section--video .video-wrap {
  width: min(1100px, 94%); margin: 0 auto; border-radius: 16px; overflow: clip;
  border: 1px solid var(--line); box-shadow: var(--shadow); background: #000;
}
.section--video video { width: 100%; height: auto; }

/* ========== FRAGRÃ‚NCIAS ========== */
.fragrance-grid {
  width: min(1200px, 94%); margin: 0 auto;
  display: grid; grid-template-columns: repeat(2, 1fr); gap: clamp(16px, 3vw, 24px);
}
.fragrance-card {
  background: #fff; border: 1px solid var(--line); border-radius: 18px;
  padding: clamp(16px, 3vw, 24px); display: grid; justify-items: center; gap: 10px;
  text-align: center; box-shadow: 0 6px 18px rgba(0,0,0,.06);
}
.fragrance-card img { width: min(380px, 88%); height: auto; }

/* ========== SUSTENTABILIDADE (Parallax Vertical com Zoom/Cobertura) ========== */
.sustainability-parallax { 
  position: relative;
  width: 100%;
  background: #1a1a1a; /* igual ao teste.html */
  /* altura é configurada via JavaScript: (painéis + 1) * 100vh */
}

/* Painel em tela cheia com posição sticky */
.sustainability-parallax .fullscreen-panel {
  position: sticky;
  top: 0;
  left: 0;
  width: 100%;        /* como no teste.html */
  height: 100vh;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: transparent !important; /* allow section theme background to show through */
}

/* Container flexível para o conteúdo do painel */
.sustainability-parallax .panel-content {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: row !important; /* garante imagem e texto lado a lado por padrão */
  flex-wrap: nowrap;
  align-items: center;
  justify-content: space-between;
  padding: clamp(1.5rem, 5vw, 4rem);
  gap: clamp(1.5rem, 5vw, 4rem);
  /* RESET do estilo de .panel-content usado na seção horizontal */
  max-width: none !important;
  background: transparent !important;
  border: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
}

/* Remove o efeito de hover herdado da seção horizontal */
.sustainability-parallax .panel-content:hover {
  transform: none !important;
  box-shadow: none !important;
}

/* Inverte a direção quando a imagem deve estar à direita */
.sustainability-parallax .fullscreen-panel[data-layout="right-image"] .panel-content {
  flex-direction: row-reverse !important;
}

/* left-image sempre imagem à esquerda, texto à direita */
.sustainability-parallax .fullscreen-panel[data-layout="left-image"] .panel-content {
  flex-direction: row !important;
}

/* alinhamento da imagem encostada à borda correta */
.sustainability-parallax .fullscreen-panel[data-layout="right-image"] .image-column { align-items: flex-end; }
.sustainability-parallax .fullscreen-panel[data-layout="left-image"]  .image-column { align-items: flex-start; }

/* Colunas de texto e imagem com tamanhos iguais */
.sustainability-parallax .text-column,
.sustainability-parallax .image-column {
  flex: 1;
  max-width: 50%;
  height: 100%;
}

/* center text vertically inside the text column */
.sustainability-parallax .text-column { 
  display:flex; 
  flex-direction:column; 
  justify-content:flex-start; /* move texto para o topo */
  align-items:flex-start; 
  padding: 3rem 2rem; /* mais padding no topo */
}

/* central por padrão; alinhamento final vem do data-layout */
.sustainability-parallax .image-column { align-items: center; }

/* Container da imagem com proporção fixa */
.sustainability-parallax .image-wrapper {
  width: clamp(320px, 48vw, 520px);
  margin: 0 auto;
  aspect-ratio: 3 / 4.1; /* um pouco maior que antes */
  overflow: hidden;
  border-radius: 16px;
  transform-origin: center center;
}

.sustainability-parallax .image-wrapper img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

/* Estilos de texto */
.sustainability-parallax .text-column h2 {
  font-size: clamp(2.8rem, 6.5vw, 5rem);
  line-height: 1.02;
  margin-bottom: 1rem;
  color: #f0f0f0;
}

.sustainability-parallax .text-column p {
  font-size: 1.1rem;
  line-height: 1.7;
  color: #ffffff; /* changed from gray to white */
  max-width: 55ch;
}

/* Painel de introdução */
.sustainability-parallax .intro-panel {
  display: grid;
  place-items: center;
  text-align: center;
}

.sustainability-parallax .intro-panel h1 {
  font-size: 3rem;
  color: #f0f0f0;
  margin-bottom: 0.5rem;
}

.sustainability-parallax .intro-panel p {
  font-size: 1.2rem;
  color: #ffffff; /* changed from gray to white */
}

/* Responsividade */
@media (max-width: 900px) {
  .sustainability-parallax .panel-content {
    flex-direction: column !important;
    text-align: center;
    justify-content: center;
    gap: 2rem;
  }

  .sustainability-parallax .text-column,
  .sustainability-parallax .image-column {
    max-width: 100%;
  }

  .sustainability-parallax .text-column h2 { font-size: clamp(2rem, 8vw, 3rem); }
  .sustainability-parallax .text-column p  { margin: 0 auto; }

  .sustainability-parallax .image-wrapper {
    width: min(320px, 80vw);
    aspect-ratio: 3 / 4.5;
  }
}

/* ========== TESTEMUNHOS ========== */
.testimonials--glass {
  position: relative;
  overflow: hidden;
}
.t-bg-title {
  position: absolute; inset: auto 0 10%;
  text-align: center;
  font-family: 'Syne', sans-serif;
  font-size: clamp(4rem, 18vw, 14rem);
  line-height: .9;
  color: rgba(0,0,0,.12);
  mix-blend-mode: normal;
  pointer-events: none;
  z-index: 0;
}
.t-cards {
  width: min(1200px, 92%);
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: clamp(16px, 3vw, 32px);
  align-items: start;
  position: relative;
  z-index: 1;
}
/* Glassmorphism aprimorado: bolha translúcida */
.t-card {
  position: relative;
  padding: clamp(18px, 2.6vw, 24px);
  border-radius: 22px;
  border: 1.5px solid rgba(255,255,255,0.32);
  background: linear-gradient(135deg, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.10) 100%);
  backdrop-filter: blur(18px) saturate(1.25);
  -webkit-backdrop-filter: blur(18px) saturate(1.25);
  color: #e9eef5;
  box-shadow: 0 12px 32px 0 rgba(0,0,0,.22), 0 1.5px 8px 0 rgba(255,255,255,0.12) inset;
  transition: box-shadow .18s, background .18s;
}
.t-card::after {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: inherit;
  pointer-events: none;
  background: radial-gradient(ellipse at 60% 20%, rgba(255,255,255,0.22) 0%, rgba(255,255,255,0.04) 80%, transparent 100%);
  opacity: 0.85;
  z-index: 2;
}
.t-card:hover {
  box-shadow: 0 16px 40px 0 rgba(0,0,0,.28), 0 2px 12px 0 rgba(255,255,255,0.16) inset;
  background: linear-gradient(135deg, rgba(255,255,255,0.28) 0%, rgba(255,255,255,0.13) 100%);
}
body.theme-citrus .t-card, body.theme-aqua .t-card { color: #0e0f12; background: rgba(255,255,255,0.8); border-color: rgba(0,0,0,0.06); }
.t-card__meta { font-size: .9rem; opacity: .7; margin-bottom: .6rem; }
.t-card__text { font-size: clamp(0.98rem, 1.2vw, 1.06rem); line-height: 1.6; margin: 0; }
.t-card__author { margin-top: .9rem; font-weight: 600; opacity: .8; }

.t-card--right { transform: translateY(-6%); }
.t-card--left  { transform: translateY(6%); }
.t-card--right { animation: t-float-right 6.5s ease-in-out infinite; will-change: transform; }
.t-card--left  { animation: t-float-left 7.2s ease-in-out infinite; will-change: transform; }

@keyframes t-float-right {
  0%, 100% { transform: translateY(-6%); }
  50%       { transform: translateY(-10%); }
}
@keyframes t-float-left {
  0%, 100% { transform: translateY(6%); }
  50%       { transform: translateY(2%); }
}

.t-stats {
  width: min(1100px, 92%);
  margin: clamp(22px, 6vw, 52px) auto 0;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 24px;
  text-align: center;
  position: relative;
  z-index: 1;
}
.t-stat__num { font-family: 'Syne', sans-serif; font-size: clamp(2rem, 6vw, 3.2rem); }
.t-stat__label { opacity: .75; }

@media (max-width: 900px) {
  .t-cards { grid-template-columns: 1fr; }
  .t-card--right, .t-card--left { transform: none; animation: none; }
  .t-bg-title { font-size: 22vw; bottom: 14%; }
}

/* ========== FAQ (accordeão animado) ========== */
#faq { scroll-margin-top: 96px; }

#faq h2 { color: #fff; }

#faq .faq-accordion {
  --d: 0deg;
  --circle-x: 1.8rem;
  --circle-y: 50%;
  --circle-r: 200%;
  --size-accordion-title: 1.25rem;
  --size-accordion-content: 1rem;
  --animation-speed: 100;
  --slide-ease: cubic-bezier(0.86, 0, 0.07, 1);
  --slide-duration: calc(400ms * 100 / var(--animation-speed));
  --slide-delay: calc(450ms * 100 / var(--animation-speed));
  --circle-duration: calc(900ms * 100 / var(--animation-speed));

  /* Cores padrão (fundo branco, texto preto) */
  background-color: #FFFFFF;
  color: #000000;

  width: min(900px, 92%);
  margin: 0 auto 1rem;
  border-radius: min(12px, 0.5rem);
  display: grid;
  grid-template-rows: auto 0fr; 
  overflow: hidden;
  position: relative;
  
  /* Transições incluindo cor do texto */
  transition: box-shadow 200ms ease, 
              grid-template-rows var(--slide-duration) var(--slide-ease),
              color var(--slide-duration) ease;
  box-shadow: none;
  border: none;
  scroll-margin-top: 88px;
}

/* Force-remove any stray borders/lines on the FAQ cards or their pseudos
   (some browsers/overlapping backgrounds could cause faint corner lines) */
#faq .faq-accordion,
#faq .faq-accordion::before,
#faq .faq-accordion::after {
  box-shadow: none !important;
  border: none !important;
  outline: none !important;
  background-clip: padding-box !important; /* avoid strokes showing beyond radius */
}

/* Estado aberto - texto fica branco */
#faq .faq-accordion.open {
  --d: 90deg;
  grid-template-rows: auto 1fr; 
  color: #FFFFFF; /* Texto fica branco */
}

#faq .faq-accordion .content {
  overflow: hidden;
  font-size: var(--size-accordion-content);
  line-height: 140%;
  z-index: 2; /* fica na frente da animação de fundo */
}

#faq .faq-accordion .wrapper {
  padding-block: 0 1.05rem;
  padding-inline: 1.25rem;
}

#faq .faq-accordion .content p { 
  margin: 0; 
  color: currentColor; /* herda cor do accordion */
}

#faq .faq-accordion .title {
  z-index: 2; /* fica na frente da animação de fundo */
}

#faq .faq-accordion .title a {
  padding: 1rem 1.25rem;
  font-size: var(--size-accordion-title);
  font-weight: 800;
  color: currentColor; /* Herda a cor do .accordion (preto ou branco) */
  text-decoration: none;
  display: flex;
  align-items: center;
}

#faq .faq-accordion .title a::before {
  --chevron-icon: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 320 512'%3E%3Cpath fill='currentColor' d='M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z'/%3E%3C/svg%3E");
  content: "";
  width: 0.65rem;
  aspect-ratio: 320 / 512;
  display: inline-block;
  margin-right: 0.75rem;
  transform: rotate(var(--d, 0deg));
  transition: transform var(--slide-ease) var(--slide-duration) var(--slide-delay);
  mask-image: var(--chevron-icon);
  mask-size: 100%;
  background-color: currentColor; /* Herda a cor (preto ou branco) */
}

/* Animação de fundo com círculo expandindo */
#faq .faq-accordion::before {
  content: "";
  position: absolute;
  width: 100%;
  height: 100%;
  background-color: #1E1E1E; /* A cor preta do fundo */
  transition: clip-path var(--circle-duration) ease;
  pointer-events: none;
  clip-path: circle(0% at var(--circle-x) var(--circle-y));
  border-radius: inherit;
  z-index: 1; /* Fica entre o fundo branco e o conteúdo */
}

/* Expande o círculo preto quando o card está aberto */
#faq .faq-accordion.open::before {
  clip-path: circle(var(--circle-r) at var(--circle-x) var(--circle-y));
}

#faq .faq-accordion .title a:focus-visible { 
  outline: 2px solid var(--brand); 
  outline-offset: 3px; 
  border-radius: 10px; 
  background: rgba(0,0,0,0.03); 
}

/* Temas: mantém cartões claros sobre fundos fortes */
body.theme-aqua #faq .faq-accordion,
body.theme-citrus #faq .faq-accordion { 
  background: #fff; 
  border: none; 
  box-shadow: none;
}

/* ========== FOOTER ========== */
.site-footer {
  /* tamanho alto conforme solicitado */
  height: 70vh;
  min-height: 420px;
  background: #fff;
  border-top: 1px solid var(--line);
  /* radius apenas no topo para um visual suave */
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  overflow: hidden;
  position: relative;
  z-index: 20; /* appear above the previous section for the parallax overlap */
  will-change: transform;
  display: flex;
  align-items: center; /* centra verticalmente o conteúdo */
  justify-content: center;
  padding: 24px 0;
  /* sombra sutil para separar do conteúdo acima */
  box-shadow: 0 -8px 24px rgba(0,0,0,0.04);
}
.footer-inner {
  width: min(1200px, 94%);
  margin: 0 auto;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: var(--muted);
  gap: 16px;
}
.footer-links { display: flex; gap: 16px; }

/* ========== STATES PARA REVEALS (GSAP SplitText) ========== */
/* (remoção) estilos de reveal por linhas/palavras */

/* Nav e botÃµes no hero (entrada suave) â€“ serÃ£o animados no JS */
.hero .btn,
.nav { will-change: transform, opacity; }

/* ========== RESPONSIVO ========== */
@media (max-width: 1280px) {
  .benefit-grid { grid-template-columns: repeat(3, 1fr); }
  .shop .product-grid { grid-template-columns: repeat(3, 1fr); }
  .badges { grid-template-columns: repeat(2, 1fr); }
}

@media (max-width: 900px) {
  .nav-links { display: none; }
  .capsule3d-ui { grid-template-columns: 1fr; gap: 12px; }
  .howto-steps { grid-template-columns: 1fr; }
  .fragrance-grid { grid-template-columns: 1fr; }
  .shop .product-grid { grid-template-columns: 1fr 1fr; }
  .testimonial-grid { grid-template-columns: 1fr; }
  /* Hero adjustments – tighter mask and more room for title */
  :root { --mask-start: 58%; --seam-height: 18vh; }
  .hero-content { width: min(100%, 92%); padding-inline: 16px; }
  .hero-content h1 { font-size: clamp(2.2rem, 9.5vw, 3.6rem); line-height: .98; }
  .hero-ctas { justify-content: center; gap: 10px; }
}

@media (max-width: 600px) {
  .footer-inner { flex-direction: column; gap: 8px; }
  .hero-ctas { width: 100%; justify-content: center; }
  .fragrance-toggle { right: 12px; bottom: 12px; padding: 6px; }
  .sopy-btn { width: 100%; }
  /* Make hero title very bold and multi-line; reduce video seam */
  :root { --mask-start: 62%; --seam-height: 16vh; }
  /* Force the hero to start content near the top on small screens */
  .hero, #hero { 
    min-height: 100svh; 
    height: 100svh; /* força altura completa para preencher */
    padding-top: calc(110px + env(safe-area-inset-top)); /* mais espaço acima para o header */
    justify-content: flex-start; /* puxa o conteúdo para o topo */
    align-items: stretch;
  }
  .hero-content { gap: 10px; }
  .hero-content h1 {
    font-size: clamp(2.4rem, 12vw, 3.2rem);
    line-height: .96;
    letter-spacing: -0.01em;
  }
}

/* ========== REDUÃ‡ÃƒO DE MOVIMENTO (acessibilidade) ========== */
@media (prefers-reduced-motion: reduce) {
  * { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; scroll-behavior: auto !important; }
}

/* ========== UTILITÃRIOS ========== */
.hide { display: none !important; }
.center { text-align: center; }
.max-w { width: min(1100px, 94%); margin-inline: auto; }

/* -------------------------------------------------------
   Fim
------------------------------------------------------- */

/* Removed scroll progress bar */

.scroll-to-top {
  position: fixed; right: 18px; bottom: 18px; z-index: 60;
  display: grid; place-items: center; width: 56px; height: 56px;
  border-radius: 999rem; border: none; background: transparent;
  box-shadow: none; cursor: default; pointer-events: none; /* nÃ£o intercepta scroll/click */
}
.scroll-to-top .arrow-up { position: absolute; font-size: 16px; color: var(--brand-dark); opacity: 0; transition: opacity .2s ease; }
.progress-circle { transform: rotate(-90deg); }
.progress-circle-bg { stroke: rgba(0,0,0,.08); }
.progress-circle-bar { stroke: var(--brand); stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset .08s linear; }

/* ========== SEÃ‡Ã•ES COM FUNDO TEMÃTICO (CORES FORTES) ========== */
/* AQUA â€” blocos fortes e contrastantes */
body.theme-aqua #beneficios {
  background: #0D1B2A; /* brand */
}

body.theme-aqua #como-usar {
  background: #1B263B; /* dark */
}


body.theme-aqua #sustentabilidade {
  background: #0D1B2A; /* aqua theme: set to requested blue */
}

body.theme-aqua #testemunhos {
  background: #007BFF ; /* brand */
}

body.theme-aqua #faq {
  background: #0D1B2A ; /* dark */
}

body.theme-aqua #capsula-3d {
  background: linear-gradient(180deg,rgba(253, 254, 254, 1) 0%, rgba(103, 167, 194, 1) 93%, rgba(64, 154, 192, 1) 100%);
}

/* CITRUS â€” verdes fortes com neutros escuros para variaÃ§Ã£o */
body.theme-citrus #beneficios {
  background: #1B4332; /* brand */
}

body.theme-citrus #como-usar {
  background: #167312; /* dark */
}

body.theme-citrus #fragrancias {
  background: #436147; /* secondary */
}

body.theme-citrus #sustentabilidade {
  background: #5FD97E; /* updated to requested green for both themes  1B4332*/
}

body.theme-citrus #testemunhos {
  background: #2D6A4F; /* brand */
}

body.theme-citrus #faq {
  background: #1B4332; /* dark */
}

body.theme-citrus #capsula-3d {
    background: linear-gradient(180deg,rgba(253, 254, 254, 1) 0%, rgba(183, 215, 212, 1) 50%, rgba(21, 135, 84, 1) 100%)

}

/* Ensure panels inside the sustainability section use a solid background matching the section theme */
body.theme-aqua #sustentabilidade .fullscreen-panel {
  background-color: #0D1B2A !important; /* solid blue for aqua theme */
}

body.theme-citrus #sustentabilidade .fullscreen-panel {
  background-color: #1B4332 !important; /* solid green for citrus theme */
}

.tc-testimonials{ padding: clamp(24px, 6vw, 56px) 24px; overflow-x: hidden; min-height: 100vh; display:flex; align-items:center }
.tc-wrap{ max-width: 1200px; margin: 0 auto; display: grid; gap: clamp(20px, 4vw, 40px); grid-template-columns: 1fr }
@media (min-width: 960px){ .tc-wrap{ grid-template-columns: 1fr 1.4fr } }

/* cores por tema (section background) */
body.theme-aqua .tc-testimonials{ background: radial-gradient(60% 120% at 85% 60%, rgba(29,221,242,.06), transparent 55%), var(--brand-dark); color:#e9e9ee }
body.theme-citrus .tc-testimonials{ background: radial-gradient(60% 120% at 85% 60%, rgba(95,217,126,.06), transparent 55%), var(--brand-dark); color:#e9e9ee }

.tc-left .tc-title{ font-size: clamp(28px, 4vw, 44px); line-height:1.12; letter-spacing:.2px; margin:0 0 16px; font-weight:800 }
.tc-sub{ color:#cfd6d8; max-width:44ch; margin:0 0 24px }
.tc-cta{ display:flex; gap:14px; flex-wrap:wrap }
/* Match header CTA (sopy-btn) spacing/behavior */
.sopy-tc-btn{
  --_bg: var(--brand);
  --_fg: #fff;
  --_bd: var(--brand);
  position: relative;
  display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
  padding:.85rem 1.8rem; border-radius:999rem;
  border:1px solid var(--_bd); background: var(--_bg); color: var(--_fg);
  font-weight:600; letter-spacing:.05em; text-decoration:none; box-shadow:none;
  transition: transform .12s ease, background .2s ease, box-shadow .2s ease, color .2s ease, border-color .2s ease;
  overflow:hidden;
}

.sopy-tc-btn::before{
  content:"";
  position:absolute; left:var(--xPos, 50%); top:var(--yPos, 50%);
  transform:translate(-50%, -50%);
  width:0; height:0; background-color:rgba(255,255,255,0.15);
  border-radius:50%; transition: width 1.5s ease, height 1.5s ease; z-index:0;
}
.sopy-tc-btn *{ position:relative; z-index:1; }
.sopy-tc-btn:hover{ transform: translateY(-1px); box-shadow: 0 10px 18px rgba(0,0,0,.08); }
.sopy-tc-btn:active{ transform: translateY(0); box-shadow: none; }
.sopy-tc-btn:hover::before{ width:400px; height:400px; }
.sopy-tc-btn:focus-visible{ outline:2px solid #fff2; outline-offset:2px }
/* Keep the visual variant similar but on top of header-like base */
.sopy-tc-btn--primary{ background: linear-gradient(135deg, var(--brand-2), var(--brand)); color:#1b1b1e; border:none; box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.08) }
.sopy-tc-btn--primary:hover{ transform: translateY(-1px) scale(1.02) }
.sopy-tc-btn--ghost{ background: transparent; color:#e9e9ee; border:1px solid rgba(255,255,255,0.06) }
.sopy-tc-btn--ghost:hover{ background: rgba(255,255,255,0.02) }

.tc-right{ position:relative; min-width:0 }
.tc-topActions{ display:none !important }
.tc-stack{ position:relative; overflow:hidden; min-width:0; touch-action: pan-y; cursor:grab; min-height:300px }
.tc-stack.tc-grabbing{ cursor:grabbing }
/* Glassmorphism cards: translucent surface, blur backdrop, soft border and subtle shadow */
.tc-card{ background: rgba(255,255,255,0.06); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.12); border-radius:16px; padding: clamp(20px, 3.2vw, 34px); box-shadow: 0 8px 30px rgba(6,10,12,0.22); min-height:280px; display:grid; gap:18px; overflow:hidden; color: inherit }
.tc-stack .tc-card{ position:absolute !important; inset:0 !important; margin:0 !important }
.tc-card::after{ content:""; position:absolute; inset:0; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); pointer-events:none }
.tc-quoteMark{ font-size: clamp(32px, 6vw, 52px); line-height:1; opacity:.14; user-select:none }
.tc-quote{ margin:0; font-size: clamp(16px, 1.8vw, 18px); color: rgba(255,255,255,0.95); max-width:60ch; animation: tcFade .45s ease }
@keyframes tcFade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)} }
.tc-cardFoot{ margin-top:6px; display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap }
.tc-author{ display:flex; align-items:center; gap:12px }
.tc-avatar{ width:44px; height:44px; border-radius:50%; object-fit:cover; border:1px solid rgba(255,255,255,.06); background: rgba(255,255,255,0.04) }
.tc-name{ display:block; font-weight:700 }
.tc-role{ display:block; color:#cfd6d8; font-size:13px; margin-top:-2px }
.tc-rating{ display:flex; align-items:center; gap:8px }
.tc-stars{ display:flex; gap:4px }
.tc-stars svg{ width:18px; height:18px }
.tc-score{ color:#f2f3f7; font-weight:700 }
.tc-dots{ margin-top:18px; display:flex; gap:10px; align-items:center; justify-content:center }
.tc-dot{ width:12px !important; height:12px !important; aspect-ratio:1/1 !important; border-radius:50% !important; padding:0 !important; background:#34343b !important; border:1px solid rgba(255,255,255,.06) !important; transform:none !important; transition: transform .2s ease, background .2s ease, box-shadow .2s ease }
.tc-dot[aria-selected="true"]{ background: linear-gradient(135deg, var(--brand-2), var(--brand)) !important; border-color: transparent !important; box-shadow: 0 0 0 4px rgba(7,109,242,0.18) }

/* removed duplicate .capsule3d-title-over rule to keep the one above as source of truth */

/* =========================
   Page Footer (overlap style) — uses theme variables
   ========================= */
.page-footer {
  position: relative;
  z-index: 10;
  /* Use brand color instead of brand-dark for better visual contrast */
  background: var(--brand); /* primary theme color */
  color: #ffffff; /* white text for good contrast */
  border-top-left-radius: 26px;
  border-top-right-radius: 26px;
  will-change: transform;
  transform: translateZ(0) translateY(100px); /* start offset down for animation */
  /* make footer taller */
  min-height: 560px;
  box-shadow: 0 -12px 30px rgba(0,0,0,.18);
}
.page-footer .footer-inner {
  padding: 10vh 6vw 32vh; /* increase top and bottom padding to make it taller */
  max-width: 1200px;
  margin-inline: auto;
}
.page-footer .footer-inner h3 {
  margin: 0 0 12px 0;
  color: var(--muted);
  font-size: 1.4rem;
}
.page-footer .footer-inner {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 32px;
}

.page-footer .footer-left {
  flex: 1 1 48%;
  display:flex;
  flex-direction: column;
  gap: 20px;
}

.page-footer .footer-cols {
  display: flex;
  gap: 48px;
  align-items: flex-start;
}

.page-footer .col-sitemap, .page-footer .col-legal { min-width: 180px; }

.page-footer .cols { margin: 0; }
.page-footer a { display:block; color: rgba(255,255,255,0.95); text-decoration:none; margin: 6px 0; }
.page-footer strong { display:block; margin-bottom:8px; color: rgba(255,255,255,0.95); }
.page-footer .legal { opacity:.8; margin-top: 24px; color: rgba(255,255,255,0.85); }

/* Social icons (only the SVGs provided) */
.footer-social { display:flex; gap:14px; align-items:center; }
.footer-social .social-link { display:inline-flex; width:38px; height:38px; align-items:center; justify-content:center; background: rgba(255,255,255,0.06); border-radius: 8px; }
.footer-social .social-link svg { width:20px; height:20px; display:block; fill: currentColor; color: #ffffff; }

/* Make social icons follow theme color if needed (inverse appearance on light backgrounds) */
body.theme-citrus .footer-social .social-link { background: rgba(255,255,255,0.06); }
body.theme-aqua .footer-social .social-link { background: rgba(255,255,255,0.06); }

/* Responsive: stack on small screens */
@media (max-width: 900px) {
  .page-footer .footer-inner { flex-direction: column; padding: 8vh 6vw 12vh; }
  .page-footer .footer-left, .page-footer .footer-cols { width: 100%; }
  .page-footer .footer-cols { flex-direction: row; gap: 20px; margin-top: 12px; }
  .page-footer .legal { text-align: center; margin-top: 18px; }
}

/* Theme-specific: citrus uses brand color with white text */
.theme-citrus .page-footer {
  background: var(--brand); /* citrus green brand color */
  color: #ffffff;
}
.theme-citrus .page-footer a { color: rgba(255,255,255,0.9); }
.theme-citrus .page-footer strong { color: rgba(255,255,255,0.95); }

/* Ensure theme body backgrounds match the FAQ section colors so the area behind the footer aligns */
body.theme-citrus {
  background: #1B4332; /* same as citrus FAQ section */
}

body.theme-aqua {
  background: #0D1B2A; /* same as aqua FAQ section */
}

@media (prefers-reduced-motion: reduce) {
  .page-footer { transition: none !important; transform: none !important; }
}

/* ========== RESPONSIVO: COMO USAR & SUSTENTABILIDADE ========== */

/* Tablet e mobile: Como usar */
@media (max-width: 900px) {
  .horizontal-scroll-section {
    min-height: 100vh; /* manter 100vh como pedido */
    height: 100vh;
    padding: clamp(20px, 6.5vw, 32px) 0 80px; /* espaço para dots */
    display: flex;
    flex-direction: column;
    position: relative;
  }

  .how-title {
    display: block;
    color: #fff;
    font-weight: 800;
    font-size: clamp(3.8rem, 14vw, 5.4rem);
    letter-spacing: -0.02em;
    line-height: 0.94;
    text-align: left;
    margin: 0 14px 12px;
    padding: 0;
    max-width: 10.5ch; /* força quebra em ~4 linhas */
  }

  /* hide original track on mobile; we use cu-stack slider */
  .horizontal-track { display: none !important; }

  .background-text {
    display: none; /* esconder o texto de fundo no mobile; usamos o how-title */
  }

  /* Slider like testimonials */
  .cu-stack{ display:block; position:relative; overflow:hidden; min-width:0; touch-action: pan-y; cursor:grab; margin: 4px 12px 0; height: 36vh; min-height: 240px }
  .cu-stack.cu-grabbing{ cursor:grabbing }
  .cu-card{ background: rgba(255,255,255,0.06); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.12); border-radius:22px; padding: 14px; box-shadow: 0 12px 34px rgba(6,10,12,0.28); min-height: 160px; color:#fff }
  .cu-stack .cu-card{ position:absolute !important; inset: 14px 20px 18px 20px !important }
  .cu-card .panel-content{ background: transparent !important; border:0 !important; box-shadow:none !important; padding:0 !important }
  .cu-card .panel-number{ width: 30px; height:30px; font-size:.82rem; margin-bottom: 6px; }
  .cu-card p{ font-size: .9rem; line-height: 1.5 }


@media (max-width: 600px) {
  .cu-stack{ height: 34vh; min-height: 200px }
  .cu-card{ padding: 12px; border-radius: 18px; min-height: 150px }
  .cu-stack .cu-card{ inset: 10px 14px 14px 14px !important }
  .cu-card p{ font-size: .88rem }

  /* Larger heading on very small screens */
  .how-title{ font-size: clamp(4.2rem, 15.5vw, 5.8rem); max-width: 10ch; }
}
  .panel {
    width: 85vw;
    min-width: 85vw;
    height: auto;
    padding: 0;
    align-self: stretch !important;
    scroll-snap-align: center;
    flex-shrink: 0;
  }

  .panel-content {
    max-width: 100%;
    margin: 0 auto;
    padding: 28px 22px 32px;
    min-height: auto;
    height: 100%;
    border-radius: 20px;
    box-shadow: 0 10px 24px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.04);
  }

  .panel-number { width: 36px; height: 36px; font-size: 0.9rem; margin-bottom: 14px; }
  .panel-content p { font-size: 1rem; }
}

@media (max-width: 600px) {
  .horizontal-scroll-section {
    padding: 22px 0 64px;
  }

  .horizontal-track {
    padding: 0 16px;
    gap: 14px;
  }

  .panel {
    width: 88vw;
    min-width: 88vw;
  }

  .panel-content {
    padding: 22px 18px 28px;
    border-radius: 18px;
  }

  .background-text {
    font-size: clamp(1.6rem, 6.5vw, 2.1rem);
    margin-bottom: 16px;
  }
}

/* Progress dots position for mobile within the section */
@media (max-width: 900px) {
  .progress-bar {
    position: absolute;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
  }
}

/* Tablet e mobile: Sustentabilidade */
@media (max-width: 900px) {
  .sustainability-parallax .panel-content {
    flex-direction: column !important;
    text-align: center;
    padding: clamp(2rem, 6vw, 3rem);
    gap: clamp(1.5rem, 4vw, 2.5rem);
  }

  .sustainability-parallax .fullscreen-panel[data-layout="right-image"] .panel-content,
  .sustainability-parallax .fullscreen-panel[data-layout="left-image"] .panel-content {
    flex-direction: column !important;
  }

  .sustainability-parallax .text-column,
  .sustainability-parallax .image-column {
    width: 100% !important;
    max-width: 100% !important;
  }

  .sustainability-parallax .text-column {
    padding: 1rem 0;
    align-items: center;
    text-align: center;
  }

  .sustainability-parallax .image-column {
    align-items: center !important;
  }

  .sustainability-parallax .fullscreen-panel[data-layout="right-image"] .image-column,
  .sustainability-parallax .fullscreen-panel[data-layout="left-image"] .image-column {
    align-items: center !important;
  }
}

@media (max-width: 600px) {
  .sustainability-parallax .panel-content {
    padding: clamp(1.5rem, 5vw, 2rem);
    gap: clamp(1rem, 3vw, 1.5rem);
  }

  .sustainability-parallax .text-column {
    padding: 1rem 0 0.5rem; /* mais espaço no topo no mobile */
  }

  /* Padding for subtitle under SUSTENTABILIDADE */
  #sustentabilidade .text-column p {
    padding-left: 18px;
    padding-right: 18px;
    box-sizing: border-box;
  }

  /* Imagens um pouco maiores no mobile */
  .sustainability-parallax .image-wrapper {
    width: clamp(280px, 65vw, 360px);
    aspect-ratio: 3 / 3.6; /* um pouco maior no mobile */
  }

  /* Diminui fonte do título SUSTENTABILIDADE no mobile */
  #sustentabilidade h1 {
    font-size: clamp(2rem, 8vw, 3rem) !important;
    line-height: 1.1;
  }
}
  </style>



  <body class="theme-citrus"> <!-- theme-aqua | theme-citrus (toggle via JS) -->



    <!-- Barra de progresso removida -->

    <!-- ===================== HERO (VÍDEO) ===================== -->
    <main>
      <section id="hero" class="hero section--full">
        <!-- Vídeo que será revelado pelo circle-reveal -->
        <div class="hero-media">
          <video id="heroVideo" class="hero-video" muted playsinline preload="auto">
            <!-- Quando tiver uma versão WebM otimizada, adicione como primeira source -->
            <!-- <source src="assets/videos/hero.webm" type="video/webm" ../> -->
            <source src="assets/videos/hero.mp4" type="video/mp4" />
          </video>
          <!-- Poster overlay para fallback/crossfade caso o vídeo ainda não esteja tocando ao fim do loader -->
          <img class="hero-poster" src="assets/images/video-capa.jpg" alt="" aria-hidden="true" />
        </div>

        <div class="hero-content">
          <h1>
            LIMPEZA PODEROSA. <br>ZERO ESFORÇO.
          </h1>

        </div>

      </section>

      <!-- ===================== SEÇÃO 3D (PIN) ===================== -->
      <section id="capsula-3d" class="capsule3d section--full" aria-label="Cápsula 3D interativa">
        <!-- Canvas Three.js será injetado aqui -->
        <div id="three-container"></div>

        <!-- Título posicionado sobre o objeto 3D -->
        <div class="capsule3d-title-over">
          <h2>Tecnologia que dissolve 100%</h2>
        </div>

        <!-- Bloco de produto que aparece/alinhará ao final da seção 3D -->
        <div class="capsule-3d-cta" aria-hidden="true">
          <div class="capsule-3d-cta-inner">
            <h3 class="product-title" data-aqua="AQUA BLU" data-citrus="CITRUS LUSH">CITRUS LUSH</h3>
            <p class="product-price" data-aqua="R$ 120,00" data-citrus="R$ 120,00">R$ 120,00</p>
            <p class="product-copy" data-aqua="Cápsulas ultra concentradas com enzimas que dissolvem 100% e protegem as fibras. Para todas as máquinas." data-citrus="Cápsulas ultra concentradas com poder cítrico que dissolvem 100% e protegem a cor. Para todas as máquinas.">Cápsulas ultra concentradas com poder cítrico que dissolvem 100% e protegem a cor. Para todas as máquinas.</p>
            <button class="sopy-btn sopy-product-cta" data-aqua="EXPLORE AQUA BLU" data-citrus="EXPLORE CITRUS LUSH">EXPLORE CITRUS LUSH</button>
          </div>
        </div>
        <!-- decorative bubbles container: created by JS -->
        <div class="capsule-bubbles" aria-hidden="true"></div>
      </section>

      <!-- ===================== SUSTENTABILIDADE (Parallax - estrutura do template) ===================== -->
      <div id="sustentabilidade" class="scroll-container sustainability-parallax">
        <section class="fullscreen-panel intro-panel">
          <div>
            <h1>SUSTENTABILIDADE</h1>
            <p>Nossa tecnologia ecológica para um futuro mais limpo</p>
          </div>
        </section>

        <section class="fullscreen-panel" data-layout="left-image">
          <div class="panel-content">
            <div class="image-column">
              <div class="image-wrapper">
                <video src="assets/videos/video.mp4" autoplay loop muted playsinline style="width:100%;height:100%;object-fit:cover;"></video>
              </div>
            </div>
            <div class="text-column">
              <h2>Menos Plástico</h2>
              <p>Nossas embalagens usam 70% menos plástico que produtos comuns, reduzindo significativamente o impacto ambiental e a poluição dos oceanos.</p>
            </div>
          </div>
        </section>

        <section class="fullscreen-panel" data-layout="right-image">
          <div class="panel-content">
            <div class="image-column">
              <div class="image-wrapper">
                <video src="assets/videos/video (1).mp4" autoplay loop muted playsinline style="width:100%;height:100%;object-fit:cover;"></video>

              </div>
            </div>
            <div class="text-column">
              <h2>100% Biodegradável</h2>
              <p>Desenvolvemos uma fórmula completamente biodegradável que não deixa resíduos químicos prejudiciais após o uso, protegendo nossos ecossistemas.</p>
            </div>
          </div>
        </section>

        <section class="fullscreen-panel" data-layout="left-image">
          <div class="panel-content">
            <div class="image-column">
              <div class="image-wrapper">
                <video src="assets/videos/video (2).mp4" autoplay loop muted playsinline style="width:100%;height:100%;object-fit:cover;"></video>

              </div>
            </div>
            <div class="text-column">
              <h2>Vegan & Cruelty Free</h2>
              <p>Produtos 100% veganos e livres de testes em animais, certificados internacionalmente e desenvolvidos com ingredientes de origem ética.</p>
            </div>
          </div>
        </section>
          
        <section class="fullscreen-panel" data-layout="right-image">
          <div class="panel-content">
            <div class="image-column">
              <div class="image-wrapper">
                <img src="assets/images/casa.jpg" alt="Família usando produtos seguros">
              </div>
            </div>
            <div class="text-column">
              <h2>Segurança Familiar</h2>
              <p>Segurança garantida para toda a família, incluindo crianças e bebês. Fórmula hipoalergênica e testada dermatologicamente para os mais sensíveis.</p>
            </div>
          </div>
        </section>
      </div>


      <!-- ===================== COMO USAR ===================== -->
    <section class="horizontal-scroll-section">
    <h2 class="how-title" aria-hidden="false">TRES PASSOS. SÓ POR NA MAQUINA</h2>
    <div class="horizontal-track">
      <div class="background-text">TRES PASSOS. SÓ POR NA MAQUINA</div>

      <div class="panel">
        <div class="panel-content">
          <div class="panel-number">01</div>
          <p>Pegue 1 cápsula (2 para cargas grandes/alta sujeira).</p>
        </div>
      </div>
      <div class="panel">
        <div class="panel-content">
          <div class="panel-number">02</div>
          <p>Coloque direto no tambor, antes das roupas.</p>
        </div>
      </div>
      <div class="panel">
        <div class="panel-content">
          <div class="panel-number">03</div>
          <p>Inicie o ciclo — a cápsula dissolve 100%</p>
        </div>
      </div>
    </div>
    <div class="progress-bar">
      <div class="progress-dot"></div>
      <div class="progress-dot"></div>
      <div class="progress-dot"></div>
    </div>
    </section>


    <!-- ===================== BENEFÍCIOS ===================== -->
      <section id="beneficios" class="benefits section">
    <header class="section-header">
        <h2>Resultados que você vê e sente</h2>
        <p>A tecnologia Sopy em cada cápsula.</p>
    </header>
    <div class="cards-container">
        <div class="column">
            <div class="card">
                <div class="card-content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="card-icon">
                        <path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"/><path d="M20 2v4"/><path d="M22 4h-4"/><circle cx="4" cy="20" r="2"/>
                    </svg>
                    <h3 class="card-title">Remove Manchas Profundas</h3>
                    <p class="card-label">PODER DAS ENZIMAS</p>
                </div>
                <div class="card-blob"></div>
            </div>
            <div class="card">
                <div class="card-content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="card-icon">
                        <path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/>
                    </svg>
                    <h3 class="card-title">Cores Vibrantes por Mais Tempo</h3>
                    <p class="card-label">PROTEÇÃO DAS FIBRAS</p>
                </div>
                <div class="card-blob"></div>
            </div>
        </div>
        <div class="column">
            <div class="card">
                <div class="card-content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="card-icon">
                        <path d="M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"/><path d="M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"/><path d="M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"/>
                    </svg>
                    <h3 class="card-title">Tudo em Uma Cápsula</h3>
                    <p class="card-label">PRATICIDADE</p>
                </div>
                <div class="card-blob"></div>
            </div>
            <div class="card">
                <div class="card-content">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="card-icon">
                        <path d="m10 20-1.25-2.5L6 18"/><path d="M10 4 8.75 6.5 6 6"/><path d="m14 20 1.25-2.5L18 18"/><path d="m14 4 1.25 2.5L18 6"/><path d="m17 21-3-6h-4"/><path d="m17 3-3 6 1.5 3"/><path d="M2 12h6.5L10 9"/><path d="m20 10-1.5 2 1.5 2"/><path d="M22 12h-6.5L14 15"/><path d="m4 10 1.5 2L4 14"/><path d="m7 21 3-6-1.5-3"/><path d="m7 3 3 6h4"/>
                    </svg>
                    <h3 class="card-title">Para Todas as Máquinas</h3>
                    <p class="card-label">ÁGUA FRIA E QUENTE</p>
                </div>
                <div class="card-blob"></div>
            </div>
        </div>
    </div>
</section>
    
      
      <!-- ===================== DEPOIMENTOS (tc-testimonials) ===================== -->
      <section id="testemunhos" class="tc-testimonials" aria-label="Depoimentos de clientes">
        <div class="tc-wrap">
          <div class="tc-left">
            <h2 class="tc-title">Clientes que amam a Sopy</h2>
            <p class="tc-sub">Veja o que a galera diz sobre praticidade, perfume e resultado. Depoimentos reais de quem já usa no dia a dia.</p>
            <div class="tc-cta">
              <a href="/comprar.html" class="sopy-tc-btn sopy-tc-btn--primary">Comprar agora</a>
              <a href="#beneficios" class="sopy-tc-btn sopy-tc-btn--ghost">Ver benefícios</a>
            </div>
          </div>

          <div class="tc-right">
            <div class="tc-topActions" aria-hidden="true">
              <button class="tc-nav tc-prev" aria-label="Anterior"></button>
              <button class="tc-nav tc-next" aria-label="Próximo"></button>
            </div>

            <article class="tc-card" aria-live="polite">
              <div class="tc-quoteMark" aria-hidden="true">“</div>
              <p class="tc-quote"></p>
              <footer class="tc-cardFoot">
                <div class="tc-author">
                  <img class="tc-avatar" src="" alt="" />
                  <div>
                    <span class="tc-name"></span>
                    <span class="tc-role"></span>
                  </div>
                </div>
                <div class="tc-rating" aria-label="Avaliação">
                  <div class="tc-stars" aria-hidden="true"></div>
                  <span class="tc-score"></span>
                </div>
              </footer>
            </article>

            <div class="tc-dots" role="tablist" aria-label="Páginas de depoimentos"></div>
          </div>
        </div>
      </section>

      <!-- ===================== FAQ ===================== -->
      <section id="faq" class="faq section"  aria-label="Perguntas frequentes">
        <header class="section-header">
          <h2>Perguntas frequentes</h2>
        </header>

        <section class="faq-accordion" id="faq-q1">
          <h3 class="title"><a href="#faq-q1">Funciona em água fria?</a></h3>
          <div class="content">
            <div class="wrapper">
              <p>Sim. A fórmula foi pensada para atuar em todas as temperaturas.</p>
            </div>
          </div>
        </section>

        <section class="faq-accordion" id="faq-q2">
          <h3 class="title"><a href="#faq-q2">Posso usar com roupas de bebê?</a></h3>
          <div class="content">
            <div class="wrapper">
              <p>Sim. Siga o ciclo indicado pelo fabricante da máquina e da roupa.</p>
            </div>
          </div>
        </section>

        <section class="faq-accordion" id="faq-q3">
          <h3 class="title"><a href="#faq-q3">Dissolve no ciclo rápido?</a></h3>
          <div class="content">
            <div class="wrapper">
              <p>Sim, a película é hidrossolúvel e dissolve completamente.</p>
            </div>
          </div>
        </section>
      </section>
    </main>

   

    <!-- ========== LIBS: GSAP + PLUGINS ========== -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/CustomEase.min.js"></script>
    <!-- SplitText - versão mais confiável -->
    <script src="https://unpkg.com/split-type"></script>

    <!-- ========== LENIS (scroll suave) ========== -->
    <script src="https://unpkg.com/lenis@1.1.16/dist/lenis.min.js"></script>

    <!-- ========== THREE.JS + GLTFLoader (para a cápsula 3D) ========== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <!-- Loader para HDRI (necessário para as bolhas 3D) -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/RGBELoader.js"></script>

    <!-- ========== JS do projeto (vamos escrever em seguida) ========== -->

    <noscript>Ative o JavaScript para ver as animações e a cápsula 3D.</noscript>
    <!-- Fragrance toggle moved to global scope so it stays visible on all sections -->
    <div class="product-toggle-container">
      <input type="checkbox" id="product-toggle" class="pod-toggle-checkbox">
      <label for="product-toggle" class="pod-toggle-label">
        <div class="pod-toggle-handle">
          <div class="pod-image-wrapper">
            <img src="assets/images/17.png" alt="Produto Verde" class="pod-image green">
            <img src="assets/images/hit one (5).png" alt="Produto Azul" class="pod-image blue">
          </div>
        </div>
      </label>
    </div>

    <!-- Section navigation dots (generated by JS) -->
      <!-- buttons will be injected here by JS -->

    </nav>


    <script>
        // SOPY asset base helper: allows rewriting relative asset paths when HTML is injected remotely
        (function(){
          const guessBase = () => {
            // If running inside Nuvemshop, prefer absolute "/assets/" root; otherwise keep relative
            const isNuvem = /lojavirtualnuvem\.|nuvemshop\./i.test(location.hostname);
            return isNuvem ? '/assets/' : '';
          };
          const BASE = window.SOPY_ASSETS_BASE || guessBase();
          const ABS_PROTOCOL = /^(https?:)?\/\//i;
          const ABS_SPECIAL  = /^(data:|blob:)/i;
          function normalize(p){
            if (!p) return p;
            // keep absolute, data, blob and already-rooted /assets/
            if (ABS_PROTOCOL.test(p) || ABS_SPECIAL.test(p) || p.startsWith('/assets/')) return p;
            // collapse leading ./ and ensure single 'assets/' prefix
            const cleaned = p.replace(/^\.\//, '').replace(/^\/?assets\//, 'assets/');
            return BASE ? (BASE.endsWith('/') ? BASE : BASE + '/') + cleaned.replace(/^\//,'') : cleaned;
          }
          window.SOPY = Object.assign(window.SOPY || {}, {
            assetBase: BASE,
            assetUrl: normalize,
            rewriteDomAssets(){
              const pairs = [
                ['img', 'src'],
                ['video', 'src'],
                ['source', 'src'],
                ['link[rel="preload"]', 'href']
              ];
              pairs.forEach(([sel, attr])=>{
                document.querySelectorAll(sel + '['+attr+']').forEach(el=>{
                  const val = el.getAttribute(attr);
                  const next = normalize(val);
                  if (next && next !== val) el.setAttribute(attr, next);
                });
              });
            }
          });
          // Try early, and again after DOM ready
          try { window.SOPY.rewriteDomAssets(); } catch {}
          document.addEventListener('DOMContentLoaded', () => {
            try { window.SOPY.rewriteDomAssets(); } catch {}
          });
        })();
        (function(){
  // Parallax Vertical com Cobertura (escopado para a seção sustentabilidade)
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('#sustentabilidade.scroll-container.sustainability-parallax');
    if (!container) return;

    const panels = Array.from(container.querySelectorAll('.fullscreen-panel'));
    let viewportH = window.innerHeight;

    // CRÍTICO: Define a altura total para permitir o empilhamento dos sticky panels
    function setContainerHeight() {
      container.style.height = `${panels.length * 100}vh`;
    }
    setContainerHeight();

    const ZOOM_AMOUNT = 0.15;
    const BORDER_RADIUS_AMOUNT = 50;
    let ticking = false;

    function updateAnimation() {
      const scrollY = window.scrollY;
      const rect = container.getBoundingClientRect();
      const containerTop = scrollY + rect.top;
      const relativeScroll = scrollY - containerTop;
      const containerHeight = container.offsetHeight;

      // só anima quando estamos sobre a seção
      if (relativeScroll < 0 || relativeScroll > containerHeight) {
        ticking = false;
        return;
      }

      const currentIndex = Math.floor(relativeScroll / viewportH);
      const progress = (relativeScroll % viewportH) / viewportH;

      panels.forEach((panel, i) => {
        const imageWrapper = panel.querySelector('.image-wrapper');
        if (!imageWrapper) return;

        if (i === currentIndex) {
          const scale = 1 - (progress * ZOOM_AMOUNT);
          const br = 16 + (progress * BORDER_RADIUS_AMOUNT);
          imageWrapper.style.transform = `scale(${scale})`;
          imageWrapper.style.borderRadius = `${br}px`;
        } else if (i < currentIndex) {
          const finalScale = 1 - ZOOM_AMOUNT;
          const finalBR = 16 + BORDER_RADIUS_AMOUNT;
          imageWrapper.style.transform = `scale(${finalScale})`;
          imageWrapper.style.borderRadius = `${finalBR}px`;
        } else {
          imageWrapper.style.transform = 'scale(1)';
          imageWrapper.style.borderRadius = '16px';
        }
      });
      
      ticking = false;
    }

    function onScroll() {
      if (!ticking) {
        window.requestAnimationFrame(updateAnimation);
        ticking = true;
      }
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    window.addEventListener('resize', () => {
      viewportH = window.innerHeight;
      setContainerHeight();
      updateAnimation();
    });

    // primeira atualização
    updateAnimation();
  });
})();

// FAQ accordion toggle functionality
document.addEventListener('DOMContentLoaded', () => {
  const allAccordions = document.querySelectorAll('#faq .faq-accordion');

  allAccordions.forEach(accordion => {
    const titleLink = accordion.querySelector('.title a');
    
    if (titleLink) {
      titleLink.addEventListener('click', (event) => {
        event.preventDefault(); // Impede o comportamento padr3o do link

        // click coords relative to the clicked accordion
        const rect = accordion.getBoundingClientRect();
        const clickX = event.clientX - rect.left; // px from left of card
        const clickY = event.clientY - rect.top;  // px from top of card

        // Close other open accordions toward the click point (compute coords relative to each)
        allAccordions.forEach(acc => {
          if (acc === accordion) return;
          if (acc.classList.contains('open')) {
            const r = acc.getBoundingClientRect();
            const x = event.clientX - r.left;
            const y = event.clientY - r.top;
            acc.style.setProperty('--circle-x', `${x}px`);
            acc.style.setProperty('--circle-y', `${y}px`);
            // force reflow so the CSS var is applied before starting the close animation
            // eslint-disable-next-line no-unused-expressions
            acc.offsetWidth;
            acc.classList.remove('open');
          }
        });

        const isOpen = accordion.classList.contains('open');

        // Set the click origin for the clicked accordion
        accordion.style.setProperty('--circle-x', `${clickX}px`);
        accordion.style.setProperty('--circle-y', `${clickY}px`);
        // force reflow so the CSS var is applied before toggling class
        // eslint-disable-next-line no-unused-expressions
        accordion.offsetWidth;

        if (isOpen) {
          // close this accordion toward the click point
          accordion.classList.remove('open');
        } else {
          // open this accordion from the click point
          accordion.classList.add('open');
        }
      });
    }
  });
});

/* =========================
  1) GSAP Setup + Lenis (limpo)
  Safe plugin registration: register only after window.onload so CDNs have a chance to load.
========================= */
function registerGSAPOnce() {
  if (!window.gsap || window.__gsapPluginsRegistered) return;
  const plugs = [];
  if (typeof ScrollTrigger !== "undefined") plugs.push(ScrollTrigger);
  if (typeof CustomEase !== "undefined")   plugs.push(CustomEase);
  if (typeof SplitText !== "undefined")    plugs.push(SplitText);
  if (plugs.length && typeof gsap.registerPlugin === 'function') gsap.registerPlugin(...plugs);

  // Crie as eases uma única vez
  if (typeof CustomEase !== "undefined") {
    if (!CustomEase.get("hop"))       CustomEase.create("hop",       "0.9,0,0.1,1");
    if (!CustomEase.get("osmo-ease")) CustomEase.create("osmo-ease", "0.625, 0.05, 0, 1");
  }

  window.__gsapPluginsRegistered = true;
}
window.addEventListener('load', registerGSAPOnce);

/* (removido) setupOsmoWordsAnimation em favor de initMaskedTextRevealGlobal */

/* main.js â€” Sopy Landing + E-com
   Requer: gsap + ScrollTrigger + SplitText + CustomEase + lenis + three + GLTFLoader
*/

/* =========================
   0) Utils
========================= */
const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

/* =========================
  1) GSAP Setup + Lenis
  (legacy guarded registration removed — handled by registerGSAPOnce())
========================= */
// (plugins are registered on window.load via registerGSAPOnce)

/* =========================
   Button Ripple Effect
========================= */
function setupButtonRipples() {
  const buttons = document.querySelectorAll('.sopy-btn');

  buttons.forEach(btn => {
    btn.addEventListener('mousemove', (event) => {
      const rect = btn.getBoundingClientRect();
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;

      btn.style.setProperty("--xPos", x + "px");
      btn.style.setProperty("--yPos", y + "px");
    });
  });
}

// Inicializar ripples apÃ³s DOM estar pronto
document.addEventListener('DOMContentLoaded', setupButtonRipples);

/* =========================
   SplitText: Osmo Style Animations (exclude #hero)
========================= */
// Esperar que tudo carregue completamente
window.addEventListener('load', function() {
  // Dar um tempo extra para garantir que tudo está pronto
  setTimeout(() => {
    // Confirmar que GSAP está carregado
    if (typeof gsap === "undefined") {
      console.error("GSAP não encontrado!");
      return;
    }
    
    // Registrar apenas plugins disponíveis (evita erro se CDN não carregou)
    if (typeof gsap.registerPlugin === "function") {
      const available = [];
      if (typeof ScrollTrigger !== 'undefined') available.push(ScrollTrigger);
      if (typeof CustomEase !== 'undefined') available.push(CustomEase);
      if (available.length) gsap.registerPlugin(...available);
    }
    
    // Criar custom ease exatamente como no Osmo
    if (typeof CustomEase === "function") {
      CustomEase.create("osmo-ease", "0.625, 0.05, 0, 1");
    }
    
    // Adicionar CSS diretamente para garantir mascaramento
    const style = document.createElement('style');
    style.textContent = `
      .split-line, .split-word, .split-char {
        overflow: hidden !important;
        position: relative;
        display: inline-block;
        vertical-align: top;
      }
      .split-line > *, .split-word > *, .split-char > * {
        display: inline-block;
        will-change: transform;
      }
    `;
    document.head.appendChild(style);
    
  // Obter TODOS os elementos de texto exceto os do hero
  const titles = document.querySelectorAll('h1:not(#hero *), h2:not(#hero *), h3:not(#hero *), h4:not(#hero *), .tc-title, .tc-sub');
  const paragraphs = document.querySelectorAll('p:not(#hero *), .tc-quote, .subtitle, .card-label, .footer-desc');
  // Buttons only (exclude FAQ links entirely to keep them clickable)
  const buttons = document.querySelectorAll('.sopy-btn:not(#hero *), .sopy-tc-btn:not(#hero *)');

  console.log(`Found: ${titles.length} titles, ${paragraphs.length} paragraphs, ${buttons.length} buttons`);
    
    // Função para animar elemento
    function animateElement(element, type = 'lines') {
      // Garantir que o elemento existe
      if (!element || !element.textContent.trim()) return;
      
      console.log(`Animating ${element.tagName} with ${type}`);
      
      // 1. Quebrar o texto
      let result;
      try {
        if (type === 'lines') {
          result = new SplitType(element, { 
            types: 'lines',
            lineClass: 'split-line'
          });
        } else if (type === 'words') {
          result = new SplitType(element, { 
            types: 'words',
            wordClass: 'split-word'
          });
        } else {
          result = new SplitType(element, { 
            types: 'chars',
            charClass: 'split-char'
          });
        }
      } catch (e) {
        console.error(`Error splitting ${element.tagName}:`, e);
        return;
      }
      
      // 2. Adicionar spans internos para conteúdo
      let targets = [];
      if (type === 'lines' && result.lines) {
        result.lines.forEach(line => {
          const content = line.innerHTML;
          line.innerHTML = `<span>${content}</span>`;
          targets.push(line.children[0]);
        });
      } else if (type === 'words' && result.words) {
        result.words.forEach(word => {
          const content = word.innerHTML;
          word.innerHTML = `<span>${content}</span>`;
          targets.push(word.children[0]);
        });
      } else if (result.chars) {
        result.chars.forEach(char => {
          const content = char.innerHTML;
          char.innerHTML = `<span>${content}</span>`;
          targets.push(char.children[0]);
        });
      }
      
      // 3. Aplicar animação com stagger
      if (targets.length) {
        // Config baseada no tipo (como no exemplo Osmo)
        const config = {
          lines: { duration: 0.8, stagger: 0.08 },
          words: { duration: 0.6, stagger: 0.05 },
          letters: { duration: 0.4, stagger: 0.02 }
        };
        
        // Pegar config correta
        const { duration, stagger } = config[type === 'chars' ? 'letters' : type] || config.lines;
        
        // PRIMEIRO: Definir estado inicial (escondido)
        gsap.set(targets, {
          y: "110%",
          force3D: true
        });
        
        // DEPOIS: Animação GSAP para mostrar
        return gsap.to(targets, {
          y: "0%",
          duration: duration,
          stagger: stagger,
          ease: "osmo-ease",
          force3D: true,
          scrollTrigger: {
            trigger: element,
            start: "top 85%",
            once: true,
            onEnter: () => console.log(`⚡ Triggered: ${element.tagName}`)
          }
        });
      }
    }
    
    // Processar elementos por grupo e tipo
    // Skip titles inside FAQ to preserve click behavior
    titles.forEach(element => {
      if (element.closest('#faq')) return;
      animateElement(element, 'lines');
    });
    paragraphs.forEach(element => animateElement(element, 'words'));
    // Animate buttons by words (avoids weird letter spacing on buttons)
    buttons.forEach(element => animateElement(element, 'words'));

    // Add a simple fade/slide-in to FAQ cards (no text splitting)
    document.querySelectorAll('#faq .faq-accordion').forEach(acc => {
      gsap.from(acc, {
        opacity: 0,
        y: 24,
        duration: 0.6,
        ease: 'osmo-ease',
        scrollTrigger: {
          trigger: acc,
          start: 'top 90%',
          once: true
        }
      });
    });
    
    console.log("✅ Osmo animations initialized!");
    
    // Forçar ScrollTrigger refresh (guardado para evitar ReferenceError se não carregou)
    if (typeof ScrollTrigger !== 'undefined' && ScrollTrigger && typeof ScrollTrigger.refresh === 'function') {
      try { ScrollTrigger.refresh(); } catch (e) { /* ignore */ }
    }
    
  }, 800); // Aumento do delay para garantir que o Lenis está pronto
});

  function initAll() {
    // Build a stable list: only visible in DOM
    const candidates = Array.from(document.querySelectorAll(selector));
    candidates.forEach(createFor);
  }

  function destroyAll() {
    instances.forEach(({ split, tween, el }) => {
      if (tween && tween.kill) tween.kill();
      if (split && split.revert) split.revert();
      if (el && el.dataset) delete el.dataset.splitDone;
    });
    instances = [];
  }

/* Lenis (scroll suave) - configuração igual ao exemplo */
const lenis = new Lenis()
// Atualiza o ScrollTrigger via Lenis se o plugin estiver disponível
if (typeof ScrollTrigger !== 'undefined' && ScrollTrigger && typeof ScrollTrigger.update === 'function') {
  lenis.on('scroll', ScrollTrigger.update);
} else {
  // fallback seguro: registra um listener vazio para manter a API coerente
  lenis.on('scroll', () => {});
}
gsap.ticker.add((time)=>{
  lenis.raf(time * 1000)
})
gsap.ticker.lagSmoothing(0)

// Configuração do GSAP
gsap.ticker.lagSmoothing(0);

// Observer para atualizar o Lenis quando necessário
const resizeObserver = new ResizeObserver(() => {
  lenis.resize();
});
resizeObserver.observe(document.body);

// Sempre iniciar no topo ao recarregar
try {
  if ('scrollRestoration' in history) history.scrollRestoration = 'manual';
} catch { }
window.scrollTo(0, 0);
try { lenis.stop(); } catch { }
document.body.classList.add('is-loading');

/* =========================
  2) Loader 0→100 + Circle Reveal
========================= */
const loaderEl = document.getElementById("loader");
const countEl = document.getElementById("loader-count");
const countPrefixEl = document.querySelector(".count-prefix");
const dividerEl = document.querySelector(".loader-divider"); // no longer used (kept for DOM query safety)
const circleEl = document.querySelector(".loader-circle");
const blocks = []; // overlay blocks removed
const heroVideo = document.getElementById("heroVideo");
const heroPoster = document.querySelector(".hero-poster");

// Garantimos que o vÃ­deo NÃƒO inicie antes do loader terminar
if (heroVideo) {
  try {
    heroVideo.muted = true;
    heroVideo.playsInline = true;
    heroVideo.setAttribute("preload", "auto");
    heroVideo.pause();
    // opcional: resetar para o inÃ­cio
    heroVideo.currentTime = 0;
  } catch { }
}

// Estado do contador visual + timeline do loader (mais lenta)
const loaderObj = { n: 0 };
const tlLoader = gsap.timeline({ defaults: { ease: "hop" } });

// Helpers para prÃ©-tocar e esconder poster
let listenersAttached = false;
function hidePoster() {
  if (heroPoster) heroPoster.classList.add("is-hidden");
}
function attachPosterHide() {
  if (!heroVideo || listenersAttached) return;
  listenersAttached = true;
  const onPlay = () => { hidePoster(); cleanup(); };
  const onTime = () => { if (heroVideo.currentTime > 0) { hidePoster(); cleanup(); } };
  const cleanup = () => {
    heroVideo.removeEventListener("playing", onPlay);
    heroVideo.removeEventListener("timeupdate", onTime);
  };
  heroVideo.addEventListener("playing", onPlay, { once: true });
  heroVideo.addEventListener("timeupdate", onTime);
  // Se jÃ¡ estiver tocando, resolve imediatamente
  if (!heroVideo.paused && heroVideo.currentTime > 0) hidePoster();
}
function tryPlay() {
  heroVideo?.play?.().catch(() => { });
}
let preplayTriggered = false;

// preparar mÃ¡scara da gota (centro da tela)
if (loaderEl) {
  loaderEl.style.setProperty("--cx", "50%");
  loaderEl.style.setProperty("--cy", "50%");
  loaderEl.style.setProperty("--r", "0px");
}
// Timeline do loader: mais lenta e sÃ³ entÃ£o comeÃ§amos o vÃ­deo
// contagem 0 → 100 (mais demorada)
tlLoader.to(loaderObj, {
  n: 100,
  duration: 3.4,
  onUpdate: () => {
    const v = Math.round(loaderObj.n);
    if (countEl) countEl.textContent = v;
    if (countPrefixEl) countPrefixEl.style.display = "none";
    if (!preplayTriggered && loaderObj.n >= 90) {
      preplayTriggered = true;
      attachPosterHide();
      tryPlay();
    }
  },
});
// esconder o contador antes da gota (somente se existir)
if (document.querySelector('.loader-counter')) {
  tlLoader.to('.loader-counter', { autoAlpha: 0, y: -10, duration: 0.32, ease: 'power2.in' });
}
// gota transparente (máscara radial)
tlLoader.fromTo(
  { r: 0 },
  { r: 0 },
  {
    r: Math.hypot(window.innerWidth, window.innerHeight),
    duration: 1.1,
    ease: 'power3.inOut',
    onUpdate: function () {
      if (loaderEl) loaderEl.style.setProperty('--r', this.targets()[0].r + 'px');
    },
  }
);
// esconder loader e então iniciar o vídeo (somente se existir loader)
if (loaderEl) {
  tlLoader.to(loaderEl, {
    autoAlpha: 0,
    duration: 0.35,
    onComplete: () => {
      if (heroVideo) {
        attachPosterHide();
        tryPlay();
      }
      document.body.classList.remove('is-loading');
      try { lenis.start(); } catch { }
      window.scrollTo(0, 0);
    },
  });
} else {
  // sem loader no DOM: finalize estado básico
  tlLoader.add(() => {
    document.body.classList.remove('is-loading');
    try { lenis.start(); } catch {}
  });
}
// configura reveals só após o loader
tlLoader.add(() => {
    // Inicia apenas o Osmo Masked Reveal global (exceto hero)
  // animações de texto removidas globalmente por solicitação
  if (typeof ScrollTrigger !== "undefined") try { ScrollTrigger.refresh(true); } catch {}
    // Mostrar CTA alinhado ao fim da seção 3D
    try {
      const cta = document.querySelector('.capsule-3d-cta');
      const triggerEl = document.getElementById('capsula-3d');
      if (cta && triggerEl && typeof ScrollTrigger !== 'undefined') {
        // Show the CTA only near the end of the 3D section and keep it visible.
        ScrollTrigger.create({
          trigger: triggerEl,
          // show CTA much earlier: when the section top reaches 80% of viewport
          start: 'top 80%',
          once: true,
          onEnter: () => {
            cta.classList.add('is-visible');
            cta.classList.add('at-end');
            try { ScrollTrigger.refresh(); } catch (_) {}
          },
          markers: false,
        });
      }
    } catch (e) { console.warn('CTA ScrollTrigger init failed', e); }
});
// entrada suave: só anima se existir alvo
(() => {
  const sels = ['.nav', '.hero .sopy-btn'];
  const existing = sels.filter(s => document.querySelector(s));
  if (existing.length) {
    tlLoader.from(existing.join(', '), {
      y: -16,
      autoAlpha: 0,
      duration: 0.6,
      ease: 'power2.out',
      stagger: 0.08,
    });
  }
})();
// Footer overlap animation - slide up to cover previous section
tlLoader.add(() => {
    const footer = document.querySelector('.page-footer');
    if (footer && typeof ScrollTrigger !== 'undefined') {
      ScrollTrigger.create({
        trigger: footer,
        start: 'top bottom-=100px', // trigger when footer approaches viewport
        end: 'bottom bottom',
        scrub: 1.2,
        animation: gsap.fromTo(footer, 
          { y: 100 }, // start position (down)
          { y: 0, ease: "none" } // end position (normal)
        ),
        invalidateOnRefresh: true
      });
    }
});


/* =========================
   Scroll Progress (barra + cÃ­rculo) + Voltar ao topo
========================= */
(function scrollProgress() {
  // Escopo apenas para o indicador global (se existir). Não tocar na barra da seção "como usar".
  const bar = document.querySelector('.page-progress-bar');
  const circ = document.querySelector('.progress-circle-bar');
  if (!bar && !circ) return;

  const CIRCUMFERENCE = 2 * Math.PI * 45; // r=45 no SVG

  const update = () => {
    const docHeight = document.documentElement.scrollHeight - window.innerHeight;
    const y = lenis?.scroll || window.pageYOffset || document.documentElement.scrollTop || 0;
    const p = docHeight > 0 ? y / docHeight : 0;

  if (bar) bar.style.width = Math.min(100, Math.max(0, p * 100)) + '%';
    if (circ) circ.style.strokeDashoffset = CIRCUMFERENCE * (1 - p);
  };

  // Lenis emite evento de scroll; usamos tambÃ©m resize
  lenis.on('scroll', update);
  window.addEventListener('resize', update);

  // init
  update();
})();
// reveals e UI do hero agora sÃ£o iniciados pelo tlLoader acima

/* =========================
   COMO USAR — Horizontal Scroll (GSAP)
========================= */
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('.horizontal-scroll-section');
  const track = section?.querySelector('.horizontal-track');
  const panels = track ? Array.from(track.children).filter(el => el.classList.contains('panel')) : [];
  const dots = document.querySelectorAll('.progress-bar .progress-dot');
  if (!section || !track || panels.length === 0 || typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') return;

  // Define a largura do track conforme nº de painéis em pixels para medição precisa
  const setTrackWidth = () => {
    track.style.width = `${panels.length * window.innerWidth}px`;
  };
  setTrackWidth();

  // Distância necessária para arrastar o track totalmente (px)
  const getDistance = () => Math.max(0, track.scrollWidth - window.innerWidth);

  const tween = gsap.to(track, {
    x: () => -getDistance(),
    ease: 'none',
    scrollTrigger: {
      trigger: section,
      start: 'top top',
      end: () => `+=${getDistance()}`,
      pin: true,
      scrub: 0.6,
      invalidateOnRefresh: true,
      onRefresh: setTrackWidth,
      onEnter: () => document.querySelector('.progress-bar')?.classList.add('visible'),
      onEnterBack: () => document.querySelector('.progress-bar')?.classList.add('visible'),
      onLeave: () => document.querySelector('.progress-bar')?.classList.remove('visible'),
      onLeaveBack: () => document.querySelector('.progress-bar')?.classList.remove('visible'),
      onUpdate: self => {
        if (!dots || dots.length === 0) return;
        const steps = dots.length;
        const idx = Math.min(steps - 1, Math.max(0, Math.round(self.progress * (steps - 1))));
        dots.forEach((d, i) => d.classList.toggle('active', i === idx));
      }
    }
  });

  // Atualiza em resize
  window.addEventListener('resize', () => {
    setTrackWidth();
    try { ScrollTrigger.refresh(); } catch {}
  });
});

/* =========================
   4) SeÃ§Ã£o 3D â€“ cÃ¡psula
========================= */
let THREE_READY = typeof THREE !== "undefined";
let renderer, scene, camera, capsuleGroup, rafId, running = true;
let threeEntered = false;
let gelA, gelB, gelC; // materiais para trocar cores
const threeWrap = document.getElementById("three-container");
// Hover state needs to be shared across animation loops
let hover = { x: 0, y: 0 };

// Intensidades do movimento
const THREE_CONFIG = {
  baseRotSpeed: 0,     // sem rotação automática
  floatAmp: 0,         // sem flutuação automática
  tiltLerp: 0,         // sem tilt automático
  tiltRangeX: 0,
  tiltRangeY: 0,
};

// Modelos por tema (se um arquivo nÃ£o existir, cai em fallback ou no modelo default)
const MODELS = {
  aqua: "assets/models/compressed_1758509853615_aqua.glb",
  citrus: "assets/models/compressed_1758509855927_citrus.glb",
};
let currentTheme3D = "citrus";
let currentModelKey = null; // 'theme:url'
let pendingThemeForModel = null;

const COLORS = {
  // Aqua Blu: #083DA6 (dark), #076DF2 (brand), #0C87F2 (secondary), #1DDDF2 (accent)
  aqua: { a: 0x076DF2, b: 0x0C87F2, c: 0x1DDDF2 },
  // Citrus Lush: #5FD97E (brand), #91D9A3 (secondary), #167312 (dark), #D7D9D2 (accent-neutral)
  citrus: { a: 0x5FD97E, b: 0x91D9A3, c: 0xD7D9D2 },
};

function initThree() {
  if (!THREE_READY) return;
  if (!threeWrap) return;

  scene = new THREE.Scene();
  scene.background = null;

  const w = threeWrap.clientWidth;
  const h = threeWrap.clientHeight;

  // Force minimum dimensions if container is too small
  const finalW = Math.max(w, 400);
  const finalH = Math.max(h, 300);

  camera = new THREE.PerspectiveCamera(45, finalW / finalH, 0.1, 100);
  camera.position.set(0, 0, 4.2);

  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setPixelRatio(clamp(window.devicePixelRatio, 1, 1.75));
  renderer.setSize(finalW, finalH);
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.0;
  threeWrap.appendChild(renderer.domElement);

  // luzes
  const amb = new THREE.AmbientLight(0xffffff, 1.2);
  scene.add(amb);

  const key = new THREE.DirectionalLight(0xffffff, 1.0);
  key.position.set(3, 4, 2);
  scene.add(key);

  const fill = new THREE.DirectionalLight(0xffffff, 0.8);
  fill.position.set(-3, -1, 3);
  scene.add(fill);

  // grupo base
  capsuleGroup = new THREE.Group();
  scene.add(capsuleGroup);

  // Define orientação inicial vertical
  capsuleGroup.rotation.set(0, 0, 0);

  // Se apÃ³s um tempo razoÃ¡vel ainda nÃ£o hÃ¡ objeto, cria fallback e inicia animaÃ§Ã£o
  setTimeout(() => {
    if (capsuleGroup.children.length === 0) {
      console.warn("Nenhum objeto 3D carregado atÃ© agora. Inserindo fallback...");
      createFallbackModel(currentTheme3D);
      ensureEnter3D();
    }
  }, 1200);

  // carrega o modelo do tema atual (ou pendente)
  const themeToLoad = pendingThemeForModel || currentTheme3D;
  swapModel(themeToLoad);
  // Inicia animaÃ§Ã£o de scroll assim que o modelo for carregado
  start3DScrollAnimation();
  window.addEventListener("resize", onResizeThree);
}

function enter3D() {
  // animaÃ§Ã£o de entrada
  capsuleGroup.scale.set(0, 0, 0);
  gsap.to(capsuleGroup.scale, { x: 1, y: 1, z: 1, duration: 1, ease: "power2.out", delay: 0.1 });

  // pin da seÃ§Ã£o 3D (temporariamente desabilitado para testar scroll)
  if (typeof ScrollTrigger !== "undefined") {
    ScrollTrigger.create({
      trigger: "#capsula-3d",
      start: "top top",
      end: "+=100%",
      pin: false, // Desabilitado temporariamente
      scrub: false,
    });
  }

  // flutuaÃ§Ã£o + rotaÃ§Ã£o
  const state = { t: 0 };

  function animate() {
    if (!running) { rafId = null; return; }
    state.t += 0.016;
    const floatY = Math.sin(state.t * 1.6) * THREE_CONFIG.floatAmp;
    capsuleGroup.position.y = floatY;

    // rotaÃ§Ã£o contÃ­nua leve + tilt do mouse
    capsuleGroup.rotation.y += THREE_CONFIG.baseRotSpeed;
    capsuleGroup.rotation.x += (hover.y - capsuleGroup.rotation.x) * THREE_CONFIG.tiltLerp;
    capsuleGroup.rotation.z += (hover.x - capsuleGroup.rotation.z) * THREE_CONFIG.tiltLerp;

    renderer.render(scene, camera);
    rafId = requestAnimationFrame(animate);
  }
  animate();

  // mouse tilt
  threeWrap.addEventListener("mousemove", (e) => {
    const r = threeWrap.getBoundingClientRect();
    const nx = (e.clientX - r.left) / r.width;
    const ny = (e.clientY - r.top) / r.height;
    hover.x = (nx - 0.5) * THREE_CONFIG.tiltRangeX;
    hover.y = (0.5 - ny) * THREE_CONFIG.tiltRangeY;
  });

  // pausa quando fora de viewport (economia)
  const io = new IntersectionObserver(
    (ents) => ents.forEach((en) => {
      const wasRunning = running;
      running = en.isIntersecting;
      if (running && !rafId) {
        rafId = requestAnimationFrame(animate);
      }
    }),
    { threshold: 0.05 }
  );
  io.observe(threeWrap);
}

// ========== 3D Scroll Down Effect ==========
// Faz o objeto 3D descer conforme o scroll na seÃ§Ã£o 3D
function animateWithScroll() {
  if (!running || !capsuleGroup) { rafId = null; return; }
  // Pega uma área maior que inclui a div intermediária antes da seção 3D
  const section = document.getElementById('capsula-3d');
  if (!section) { rafId = null; return; }
  const sectionRect = section.getBoundingClientRect();
  const sectionTop = window.scrollY + sectionRect.top;
  const sectionHeight = section.offsetHeight;
  const winH = window.innerHeight;
  
  // Expande a área de trigger para começar mais cedo (na div intermediária)
  const expandedStart = sectionTop - winH; // Começa 1 viewport antes da seção 3D
  const expandedHeight = sectionHeight + winH; // Área total expandida
  
  // Progresso baseado na área expandida
  const scrollY = window.scrollY || window.pageYOffset;
  let progress = clamp((scrollY - expandedStart) / expandedHeight, 0, 1);
  // Limita o progresso máximo para parar antes do final da seção
  // reduzimos para 0.6 para que o objeto e o card parem ainda mais cedo
  progress = Math.min(progress, 0.6);
  
  // Posição Y controlada por scroll com easing e leve oscilação ("dança")
  const yStart = 15.0; // início alto
  const yEnd = -9.5;   // ligeiramente mais alto no final para alinhar com o CTA
  // easing suave (easeInOutSine)
  const e = 0.5 - 0.5 * Math.cos(Math.PI * progress);
  let yBase = yStart + (yEnd - yStart) * e;
  // oscilação sutil no meio do caminho (amplitude reduzida nas extremidades)
  const midFactor = 1 - Math.abs(progress - 0.5) * 2; // 0 -> 1 -> 0
  const yWiggle = 0.6 * Math.sin(progress * Math.PI * 4) * midFactor;
  capsuleGroup.position.y = yBase + yWiggle;

  // Rotação: mapeia o progresso da seção para uma rotação completa de 360°
  // mantendo as pequenas oscilações já existentes em X e Z e adicionando
  // um pequeno componente de 'wiggle' em Y sobre a rotação principal.
  const rx = 0.08 * Math.sin(progress * Math.PI * 5);
  const ry = 0.06 * Math.sin(progress * Math.PI * 3 + 0.6);
  const rz = 0.04 * Math.sin(progress * Math.PI * 7 + 1.2);

  // O progresso foi limitado acima (max 0.6) para parar antes do fim da seção.
  // Normalizamos para 0..1 para mapear para 0..2PI (uma volta completa).
  const normalizedSpin = clamp(progress / 0.6, 0, 1);
  const spin = normalizedSpin * Math.PI * 2; // 360deg em radianos

  // Aplica rotação: Y recebe a volta completa + um pequeno ry para manter vivacidade
  capsuleGroup.rotation.set(rx, spin + ry, rz);
  renderer.render(scene, camera);
  rafId = requestAnimationFrame(animateWithScroll);
}
// Substitui o animate padrÃ£o por esse apÃ³s o modelo estar pronto
rafId = requestAnimationFrame(animateWithScroll);

function ensureEnter3D() {
  if (threeEntered) return;
  threeEntered = true;
  enter3D();
}

function onResizeThree() {
  if (!renderer || !camera) return;
  const w = Math.max(threeWrap.clientWidth, 400);
  const h = Math.max(threeWrap.clientHeight, 300);
  renderer.setSize(w, h, false);
  camera.aspect = w / h;
  camera.updateProjectionMatrix();
}

/* =========================
   3D Interactive Bubbles with Explosion Effects
   Creates realistic floating bubbles with click interactions and particle explosions.
   Uses Three.js with HDRI lighting for photorealistic materials.
========================= */
function initCapsuleBubbles() {
  const container = document.querySelector('.capsule-bubbles');
  if (!container || typeof THREE === 'undefined') return;

  // Evita inicialização múltipla
  if (container.__bubblesInitialized) return;
  container.__bubblesInitialized = true;

  // --- CONFIGURAÇÃO BÁSICA ---
  const scene = new THREE.Scene();
  // mantém o fundo transparente para integrar com a seção
  scene.background = null;
  const rect = container.getBoundingClientRect();
  const camera = new THREE.PerspectiveCamera(75, rect.width / Math.max(1, rect.height), 0.1, 1000);
  camera.position.z = 30;

  const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
  renderer.setSize(rect.width, Math.max(1, rect.height));
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.8; // Aumenta um pouco mais a exposição
  // insere o canvas dentro do container para respeitar stacking e clipping
  container.appendChild(renderer.domElement);
  // garante preenchimento do container
  Object.assign(renderer.domElement.style, { position: 'absolute', inset: '0', width: '100%', height: '100%' });

  // --- ILUMINAÇÃO E AMBIENTE (HDRI) ---
  let envMap;
  const rgbeLoader = THREE.RGBELoader ? new THREE.RGBELoader() : null;
  let hdrLoaded = false;
  if (rgbeLoader) {
    rgbeLoader
      .setPath('https://threejs.org/examples/textures/equirectangular/')
      .load(
        'venice_sunset_1k.hdr',
        function (texture) {
          texture.mapping = THREE.EquirectangularReflectionMapping;
          envMap = texture;
          scene.environment = envMap;
          // Mantém background transparente (sem definir scene.background)
          hdrLoaded = true;
          createInitialBubbles();
        },
        undefined,
        function () {
          // Falha ao carregar HDRI: segue sem envMap
          console.warn('[Bubbles] Falha ao carregar HDRI. Prosseguindo sem environment map.');
          createInitialBubbles();
        }
      );
    // Fallback de tempo: se HDRI demorar, inicia mesmo assim
    setTimeout(() => { if (!hdrLoaded) createInitialBubbles(); }, 2000);
  } else {
    // Sem RGBELoader disponível: segue sem HDRI
    createInitialBubbles();
  }

  // Se o container ainda não tiver tamanho estável, tenta ajustar em seguida
  if (rect.width < 10 || rect.height < 10) {
    requestAnimationFrame(() => {
      const r2 = container.getBoundingClientRect();
      camera.aspect = r2.width / Math.max(1, r2.height);
      camera.updateProjectionMatrix();
      renderer.setSize(r2.width, Math.max(1, r2.height));
    });
  }

  const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5);
  directionalLight.position.set(5, 10, 7.5);
  scene.add(directionalLight);

  // --- OBJETOS (AS BOLHAS) ---
  const bubbles = [];
  const bubbleCount = 10; // Mais bolhas para preencher mais o espaço
  const bubbleGeometry = new THREE.SphereGeometry(1, 64, 64);

  const bubbleMaterial = new THREE.MeshPhysicalMaterial({
    color: 0xFFFFFF,
    metalness: 0.0,
    roughness: 0.06,
    transmission: 0.55,
    transparent: true,
    opacity: 0.92,
    ior: 1.33,
    envMapIntensity: 2.2,
    thickness: 0.6,
    clearcoat: 1.0,
    clearcoatRoughness: 0.06
  });

  function createBubble() {
    const material = bubbleMaterial.clone();
    if (envMap) {
      material.envMap = envMap;
      material.transmission = 1.0;
      material.opacity = 0.85;
    } else {
      // fallback sem envMap: menos transmissão e mais opacidade
      material.transmission = 0.0;
      material.opacity = 0.35;
      material.roughness = 0.15;
      material.metalness = 0.0;
      material.clearcoat = 0.6;
      material.clearcoatRoughness = 0.2;
    }

    const bubble = new THREE.Mesh(bubbleGeometry, material);

  bubble.position.x = THREE.MathUtils.randFloatSpread(40); // ~[-20,20]
  bubble.position.y = THREE.MathUtils.randFloat(-25, -15); // começa visível na parte inferior
  bubble.position.z = THREE.MathUtils.randFloatSpread(10); // ~[-5,5]

    const scale = THREE.MathUtils.randFloat(0.4, 2.0); // Ainda mais variação no tamanho
    bubble.scale.set(scale, scale, scale);

    bubble.userData = {
      speed: THREE.MathUtils.randFloat(0.05, 0.15),
      // Movimento lateral mais natural
      amplitudeX: THREE.MathUtils.randFloat(1, 4), // Amplitude da oscilação (1 a 4 unidades)
      frequencyX: THREE.MathUtils.randFloat(0.5, 1.5), // Frequência da oscilação (mais lento/rápido)
      oscillationOffset: Math.random() * Math.PI * 2,
      originalX: bubble.position.x // Guarda a posição X inicial
    };
    
    scene.add(bubble);
    bubbles.push(bubble);
  }

  function createInitialBubbles() {
    for (let i = 0; i < bubbleCount; i++) {
      createBubble();
    }
    animate();
  }

  // --- INTERAÇÃO (CLIQUE E EXPLOSÃO) ---

  const raycaster = new THREE.Raycaster();
  const mouse = new THREE.Vector2();
  let particleSystems = []; // Renomeado para evitar conflito e ser mais descritivo

  const particleTexture = new THREE.CanvasTexture(generateParticleTexture());

  function generateParticleTexture() {
    const canvas = document.createElement('canvas');
    canvas.width = 128; // Maior resolução para partículas
    canvas.height = 128;
    const context = canvas.getContext('2d');
    const gradient = context.createRadialGradient(
      canvas.width / 2, canvas.height / 2, 0,
      canvas.width / 2, canvas.height / 2, canvas.width / 2
    );
    gradient.addColorStop(0, 'rgba(255,255,255,1)');
    gradient.addColorStop(0.2, 'rgba(255,255,255,0.7)');
    gradient.addColorStop(0.5, 'rgba(255,255,255,0.3)');
    gradient.addColorStop(1, 'rgba(255,255,255,0)');
    context.fillStyle = gradient;
    context.fillRect(0, 0, canvas.width, canvas.height);
    return canvas;
  }

  function onMouseClick(event) {
    const rect = container.getBoundingClientRect();
    const x = event.clientX - rect.left;
    const y = event.clientY - rect.top;
    mouse.x = (x / rect.width) * 2 - 1;
    mouse.y = -(y / rect.height) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);

    const intersects = raycaster.intersectObjects(bubbles);

    if (intersects.length > 0) {
      const clickedBubble = intersects[0].object;
      
      createExplosion(clickedBubble.position, clickedBubble.scale.x);
      
      scene.remove(clickedBubble);
      bubbles.splice(bubbles.indexOf(clickedBubble), 1);
      
      setTimeout(createBubble, 500); 
    }
  }

  container.addEventListener('click', onMouseClick);

  function createExplosion(position, bubbleScale) {
    const particleCount = 30; // Mais partículas para uma explosão mais densa
    
    const particleMaterial = new THREE.PointsMaterial({
      size: 0.3 * bubbleScale, // Tamanho base da partícula
      map: particleTexture,
      transparent: true,
      blending: THREE.AdditiveBlending,
      depthWrite: false,
      vertexColors: true // Habilita cores por vértice para controlar a cor individualmente
    });

    const particleGeometry = new THREE.BufferGeometry();
    const positions = [];
    const velocities = [];
    const lives = []; // Vida atual
    const maxLives = []; // Vida máxima (para variar a duração)
    const colors = []; // Cores das partículas
    const sizes = []; // Tamanhos individuais das partículas

    const baseColor = new THREE.Color(0xADD8E6); // Cor base da bolha
    const white = new THREE.Color(0xFFFFFF);

    for (let i = 0; i < particleCount; i++) {
      positions.push(position.x, position.y, position.z);
      
      const speed = THREE.MathUtils.randFloat(0.3, 0.8) * bubbleScale; // Velocidade inicial mais alta
      velocities.push(
        (Math.random() - 0.5) * speed,
        (Math.random() - 0.5) * speed,
        (Math.random() - 0.5) * speed
      );

      const life = THREE.MathUtils.randFloat(0.8, 1.5); // Vida útil mais variada
      lives.push(life);
      maxLives.push(life);

      // Cor: Começa branco e transiciona para a cor da bolha ou levemente azul
      const particleColor = baseColor.clone().lerp(white, THREE.MathUtils.randFloat(0.2, 0.8));
      colors.push(particleColor.r, particleColor.g, particleColor.b);

      sizes.push(THREE.MathUtils.randFloat(0.5, 1.5) * particleMaterial.size); // Tamanho individual
    }

    particleGeometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
    particleGeometry.setAttribute('velocity', new THREE.Float32BufferAttribute(velocities, 3));
    particleGeometry.setAttribute('life', new THREE.Float32BufferAttribute(lives, 1));
    particleGeometry.setAttribute('maxLife', new THREE.Float32BufferAttribute(maxLives, 1));
    particleGeometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
    particleGeometry.setAttribute('size', new THREE.Float32BufferAttribute(sizes, 1)); // Adiciona atributo de tamanho

    const particleSystem = new THREE.Points(particleGeometry, particleMaterial);
    scene.add(particleSystem);
    particleSystems.push(particleSystem);
  }

  // --- ANIMAÇÃO ---

  const clock = new THREE.Clock();
  const gravity = new THREE.Vector3(0, -0.05, 0); // Leve gravidade para as partículas (simulando bolhas subindo mais devagar)

  function animate() {
    requestAnimationFrame(animate);

    const delta = clock.getDelta(); // Tempo desde o último quadro

    // Animação das bolhas
    bubbles.forEach(bubble => {
      // Sobe a bolha
      bubble.position.y += bubble.userData.speed * delta * 60;

      // Oscilação lateral mais controlada e natural
      const time = performance.now() * 0.001; // Tempo em segundos
      bubble.position.x = bubble.userData.originalX + Math.sin(time * bubble.userData.frequencyX + bubble.userData.oscillationOffset) * bubble.userData.amplitudeX;


      if (bubble.position.y > 25) {
        bubble.position.y = -25;
        bubble.position.x = THREE.MathUtils.randFloatSpread(40);
        bubble.userData.originalX = bubble.position.x;
        bubble.userData.oscillationOffset = Math.random() * Math.PI * 2;
      }
    });

    // Animação das partículas de explosão
    particleSystems.forEach((system, systemIndex) => {
      const positions = system.geometry.attributes.position.array;
      const velocities = system.geometry.attributes.velocity.array;
      const lives = system.geometry.attributes.life.array;
      const maxLives = system.geometry.attributes.maxLife.array;
      const colors = system.geometry.attributes.color.array;
      const sizes = system.geometry.attributes.size.array; // Pega o atributo de tamanho individual

      let allParticlesDead = true;

      for (let i = 0; i < positions.length; i += 3) {
        const particleIndex = i / 3;

        lives[particleIndex] -= delta; // Diminui a vida com base no tempo real

        if (lives[particleIndex] > 0) {
          allParticlesDead = false;

          // Atualiza velocidade com gravidade (ou flutuabilidade oposta)
          // Para bolhas, a "gravidade" real seria para cima. Vamos simular uma leve desaceleração.
          // velocities[i+1] += gravity.y * delta; // Se quiser que as partículas "caiam"

          // Move a partícula
          positions[i] += velocities[i] * delta * 60;
          positions[i + 1] += velocities[i + 1] * delta * 60;
          positions[i + 2] += velocities[i + 2] * delta * 60;

          // Fade out (opacidade e cor)
          const lifeRatio = lives[particleIndex] / maxLives[particleIndex];
          system.material.opacity = Math.max(0, lifeRatio); // Opacidade baseada na vida

          // A cor também faz fade-out (escurecendo ou ficando transparente)
          const initialColor = new THREE.Color(colors[i], colors[i+1], colors[i+2]);
          const finalColor = new THREE.Color(0x000000); // Para onde a cor irá (preto ou transparente)
          initialColor.lerp(finalColor, 1 - lifeRatio);
          system.geometry.attributes.color.setXYZ(particleIndex, initialColor.r, initialColor.g, initialColor.b);

          // Ajusta o tamanho da partícula (encolhe)
          // system.material.size = sizes[particleIndex] * Math.pow(lifeRatio, 0.5); // Encolhe gradualmente
          // Nota: Para Three.Points, `material.size` afeta todas as partículas. Para tamanhos individuais, precisa de um shader personalizado.
          // Por enquanto, vamos deixar `material.size` fixo para o sistema e controlar a opacidade.
          // Se quisermos tamanhos individuais em PointsMaterial, precisamos de um shader customizado (mais complexo).
        } else {
          positions[i] = positions[i + 1] = positions[i + 2] = 10000; // Move para fora da vista
        }
      }

      system.geometry.attributes.position.needsUpdate = true;
      system.geometry.attributes.life.needsUpdate = true;
      system.geometry.attributes.color.needsUpdate = true; // Atualiza as cores

      if (allParticlesDead) {
        scene.remove(system);
        particleSystems.splice(systemIndex, 1);
      }
    });

    renderer.render(scene, camera);
  }

  // --- RESPONSIVIDADE ---
  function onWindowResize() {
    const r = container.getBoundingClientRect();
    camera.aspect = r.width / Math.max(1, r.height);
    camera.updateProjectionMatrix();
    renderer.setSize(r.width, Math.max(1, r.height));
  }
  window.addEventListener('resize', onWindowResize);
}

// init once three container exists; refresh on resize
document.addEventListener('DOMContentLoaded', () => {
  initCapsuleBubbles();
});

// =========================
// Testimonials (tc-testimonials)
// =========================
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('#testemunhos.tc-testimonials');
  if (!section) return;

  const data = [
    { text:"Facilitou meu dia a dia. Perfume ótimo e prático.", name:"Aline Duarte", role:"SP", rating:5, avatar:"https://i.pravatar.cc/80?img=65" },
    { text:"Resolveu manchas e economizei tempo.",           name:"Carlos Mendes", role:"RJ", rating:4.8, avatar:"https://i.pravatar.cc/80?img=33" },
    { text:"Coloquei e esqueci, roupa sai perfeita.",        name:"Julia R.",      role:"PR", rating:4.9, avatar:"https://i.pravatar.cc/80?img=47" },
    { text:"Virou padrão aqui em casa.",                      name:"Leo Martins",   role:"SC", rating:5,   avatar:"https://i.pravatar.cc/80?img=7"  }
  ];

  const right = section.querySelector('.tc-right');
  if (!right) return;
  let stack = right.querySelector('.tc-stack');
  const firstCard = right.querySelector('.tc-card');
  const dots = right.querySelector('.tc-dots');
  if (!stack && firstCard) {
    stack = document.createElement('div');
    stack.className = 'tc-stack';
    firstCard.parentNode.insertBefore(stack, firstCard);
    stack.appendChild(firstCard);
    const clone = firstCard.cloneNode(true);
    clone.querySelectorAll('[id]').forEach(n => n.removeAttribute('id'));
    stack.appendChild(clone);
    if (dots && dots.parentNode) dots.parentNode.insertBefore(dots, dots);
  }
  if (!stack) return;

  const cards = Array.from(stack.querySelectorAll('.tc-card'));
  let curr = cards[0];
  let nextC = cards[1];
  let index = 0;

  const starSVG = (filled=true)=>`<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2.5l3.09 6.26 6.9.99-5 4.86 1.18 6.88L12 18.77 5.83 21.5 7 14.62 2 9.75l6.9-1 3.1-6.25z" fill="${filled?'#FFA826':'none'}" stroke="#FFA826" stroke-width="1.3"/></svg>`;
  function renderStars(container, score){
    const full = Math.floor(score), half = score - full >= .5;
    let html = ""; for(let i=0;i<5;i++) html += i<full?starSVG(true):(i===full&&half?starSVG(true):starSVG(false));
    container.innerHTML = html;
  }
  function fillCard(card, d){
    if(!card||!d) return;
    card.querySelector('.tc-quote')?.replaceChildren(document.createTextNode(d.text));
    card.querySelector('.tc-name') ?.replaceChildren(document.createTextNode(d.name));
    card.querySelector('.tc-role') ?.replaceChildren(document.createTextNode(d.role));
    const av = card.querySelector('.tc-avatar'); if (av) { av.src=d.avatar; av.alt=`Foto de ${d.name}`; }
    renderStars(card.querySelector('.tc-stars'), d.rating);
    const sc = card.querySelector('.tc-score'); if (sc) sc.textContent = d.rating.toFixed(1);
  }

  const GAP = 24;
  const hasGSAP = () => typeof window.gsap !== 'undefined';
  const Gset = (el, p) => { if(!el) return; if (hasGSAP()) gsap.set(el,p); else { if('x' in p) el.style.transform=`translateX(${p.x}px)`; if('opacity' in p) el.style.opacity=p.opacity; } };
  const wPlus = () => stack.clientWidth + GAP;

  const dotsEl = dots;
  function buildDots(){ if(!dotsEl) return; dotsEl.innerHTML=''; data.forEach((_,i)=>{ const b=document.createElement('button'); b.className='tc-dot'; b.type='button'; b.role='tab'; b.setAttribute('aria-selected', i===index?'true':'false'); b.addEventListener('click',()=>slideTo(i)); dotsEl.appendChild(b); }); }
  function updateDots(){ if(!dotsEl) return; [...dotsEl.children].forEach((d,i)=> d.setAttribute('aria-selected', i===index?'true':'false')); }

  let preparedDir=0, isAnimating=false, pendingDir=1, pendingSteps=0, auto=null;
  function prepareNext(direction){ preparedDir=direction; const w=wPlus(); const nextIndex=(index+direction+data.length)%data.length; fillCard(nextC, data[nextIndex]); Gset(nextC,{ x: direction*w, opacity:1 }); }
  function commit(direction){ if(!preparedDir) prepareNext(direction); isAnimating=true; const w=wPlus(); const targetIndex=(index+direction+data.length)%data.length; const onComplete=()=>{ const tmp=curr; curr=nextC; nextC=tmp; index=targetIndex; updateDots(); if(pendingSteps>0){ prepareNext(pendingDir); pendingSteps--; commit(pendingDir);} else { prepareNext(1); isAnimating=false; } }; if(hasGSAP()){ gsap.timeline({defaults:{duration:.5,ease:'power3.out'}, onComplete}).to(curr,{ x:-direction*w, opacity:0 },0).to(nextC,{ x:0, opacity:1 },0); } else { Gset(curr,{ x:-direction*w, opacity:0 }); Gset(nextC,{ x:0, opacity:1 }); onComplete(); } }
  function cancelSwipe(){ const w=wPlus(); if(hasGSAP()){ gsap.to(curr,{ x:0, opacity:1, duration:.35, ease:'power3.out' }); gsap.to(nextC,{ x:preparedDir*w, duration:.35, ease:'power3.out' }); } else { Gset(curr,{ x:0, opacity:1 }); Gset(nextC,{ x:preparedDir*w }); } }
  function slideTo(target){ const len=data.length; if(target===index) return; const fwd=(target-index+len)%len; const back=(index-target+len)%len; const dir=fwd<=back?1:-1; const steps=Math.min(fwd,back)||1; if(isAnimating){ pendingDir=dir; pendingSteps+=steps; return; } prepareNext(dir); pendingDir=dir; pendingSteps=steps-1; commit(dir); }
  function startAuto(){ stopAuto(); auto=setInterval(()=> slideTo((index+1)%data.length), 7000); }
  function stopAuto(){ if(auto) clearInterval(auto); auto=null; }

  fillCard(curr, data[index]);
  prepareNext(1);
  buildDots(); updateDots();
  startAuto();

  // drag
  let dragging=false, startX=0, startY=0, dx=0, dy=0;
  stack.addEventListener('pointerdown', (e)=>{ if(isAnimating) return; dragging=true; startX=e.clientX; startY=e.clientY; dx=dy=0; preparedDir=0; stopAuto(); stack.classList.add('tc-grabbing'); stack.setPointerCapture?.(e.pointerId); }, {passive:true});
  stack.addEventListener('pointermove', (e)=>{ if(!dragging) return; dx=e.clientX-startX; dy=e.clientY-startY; if(!preparedDir && Math.abs(dx)>5 && Math.abs(dx)>Math.abs(dy)) prepareNext(dx<0?1:-1); if(!preparedDir) return; const w=wPlus(); const prog=Math.max(-1, Math.min(1, dx/w)); Gset(curr,{ x:dx, opacity: 1 - Math.min(Math.abs(prog), .2) }); Gset(nextC,{ x:preparedDir*w + dx }); });
  function endPointer(){ if(!dragging) return; dragging=false; stack.classList.remove('tc-grabbing'); const w=wPlus(); const go = Math.abs(dx) > w*0.18 && Math.abs(dx) > Math.abs(dy); if(go && preparedDir) commit(preparedDir); else cancelSwipe(); startAuto(); }
  stack.addEventListener('pointerup', endPointer);
  stack.addEventListener('pointercancel', endPointer);
});
window.addEventListener('resize', () => {
  try { initCapsuleBubbles(); } catch (e) { }
});

// Lazy-init Three.js: sÃ³ quando a seÃ§Ã£o 3D entrar na viewport
(function lazyInitThree() {
  const target = document.getElementById("capsula-3d");
  if (!target) return;

  const triggerInit = () => {
    if (renderer) return; // jÃ¡ iniciado
    const ensure = () => {
      if (!THREE_READY && typeof THREE !== "undefined") THREE_READY = true;
      if (THREE_READY) {
        initThree();
        io && io.disconnect();
      } else {
        setTimeout(ensure, 100);
      }
    };
    ensure();
  };

  // Usa IntersectionObserver para nÃ£o depender do ScrollTrigger aqui
  const io = new IntersectionObserver((entries) => {
    entries.forEach((en) => {
      if (en.isIntersecting) triggerInit();
    });
  }, { threshold: 0.15 });
  io.observe(target);

  // Se preferir, tambÃ©m inicia ao tocar na Ã¢ncora via hash
  window.addEventListener("hashchange", () => {
    if (location.hash === "#capsula-3d") triggerInit();
  });
})();

// Fallback simples caso o GLB nÃ£o carregue
function createFallbackModel(theme = "aqua") {
  if (!capsuleGroup || !THREE_READY) return;
  const isCitrus = theme === "citrus";
  const geo = isCitrus
    ? new THREE.TorusKnotGeometry(0.8, 0.24, 180, 16)
    : new THREE.IcosahedronGeometry(1, 2);
  const mat = new THREE.MeshStandardMaterial({ color: isCitrus ? 0x5FD97E : 0x076DF2, roughness: 0.35, metalness: 0.05 });
  const mesh = new THREE.Mesh(geo, mat);
  mesh.userData.isFallback = true;
  capsuleGroup.add(mesh);
  
  // SEMPRE força a rotação inicial vertical no fallback também
  capsuleGroup.rotation.set(0, 0, 0);
  capsuleGroup.position.y = 15.0;
}

// Troca o modelo conforme o tema
function swapModel(theme = "aqua") {
  currentTheme3D = theme;
  if (!THREE_READY || !capsuleGroup) { pendingThemeForModel = theme; return; }

  const url = (window.SOPY && SOPY.assetUrl) ? SOPY.assetUrl(MODELS[theme] || MODELS.aqua) : (MODELS[theme] || MODELS.aqua);
  const key = `${theme}:${url}`;
  if (currentModelKey === key) return; // jÃ¡ estÃ¡ carregado

  const loader = new THREE.GLTFLoader();
  if (THREE.DRACOLoader) {
    const dracoLoader = new THREE.DRACOLoader();
    dracoLoader.setDecoderPath('https://www.gstatic.com/draco/v1/decoders/');
    loader.setDRACOLoader(dracoLoader);
  }

  // efeito sutil de troca
  gsap.fromTo(capsuleGroup.scale, { x: 1, y: 1, z: 1 }, { x: 0.92, y: 0.92, z: 0.92, duration: 0.12, yoyo: true, repeat: 1, ease: "power2.inOut" });

  loader.load(
    url,
    (gltf) => {
      const model = gltf.scene || gltf.scenes?.[0];
      if (!model) {
        console.warn("GLB sem scene para o tema:", theme, "â€” usando fallback");
        clearNonFallbackChildren();
        createFallbackModel(theme);
        ensureEnter3D();
        currentModelKey = key;
        bindGelMaterials(null);
        return;
      }

      normalizeAndAddModel(model);
      currentModelKey = key;
      ensureEnter3D();
    },
    undefined,
    (err) => {
      console.warn("Falha ao carregar modelo do tema", theme, url, err);
      clearNonFallbackChildren();
      createFallbackModel(theme);
      ensureEnter3D();
      currentModelKey = key;
      bindGelMaterials(null);
    }
  );
}

function normalizeAndAddModel(model) {
  // Remove fallbacks e anteriores
  clearNonFallbackChildren();

  // Centraliza e normaliza escala
  const box = new THREE.Box3().setFromObject(model);
  const size = new THREE.Vector3();
  box.getSize(size);
  const center = box.getCenter(new THREE.Vector3());
  model.position.sub(center);
  const maxDim = Math.max(size.x, size.y, size.z) || 1;
  const target = 1.8;
  model.scale.setScalar(target / maxDim);

  // Materiais visÃ­veis
  model.traverse((o) => {
    if (o.isMesh) {
      o.castShadow = o.receiveShadow = false;
      if (o.material) {
        if ("transparent" in o.material) o.material.transparent = true;
        if ("roughness" in o.material) o.material.roughness = 0.35;
        if ("metalness" in o.material) o.material.metalness = 0.05;
      }
    }
  });

  capsuleGroup.add(model);
  bindGelMaterials(model);
  
  // SEMPRE força a rotação inicial vertical após adicionar qualquer modelo
  capsuleGroup.rotation.set(0, 0, 0);
  capsuleGroup.position.y = 100.0; // Posição inicial alta
}

function bindGelMaterials(model) {
  if (!model) { gelA = gelB = gelC = null; return; }
  // Tenta capturar atÃ© 3 materiais principais
  const mats = [];
  model.traverse((o) => { if (o.isMesh && o.material) mats.push(o.material); });
  gelA = mats[0] || null;
  gelB = mats[1] || gelA;
  gelC = mats[2] || gelA;
}

function clearNonFallbackChildren() {
  const toRemove = capsuleGroup.children.filter((c) => !c.userData?.isFallback);
  toRemove.forEach((obj) => capsuleGroup.remove(obj));
}

/* =========================
   5) Fragrance Toggle (tema + materiais)
========================= */
const toggleBtns = gsap.utils.toArray(".fragrance-toggle .toggle-option");
function setTheme(theme) {
  document.body.classList.toggle("theme-citrus", theme === "citrus");
  document.body.classList.toggle("theme-aqua", theme === "aqua");

  const pal = theme === "citrus" ? COLORS.citrus : COLORS.aqua;

  if (gelA && gelB && gelC) {
    const toCol = (mat, hex) => {
      const c = new THREE.Color(hex);
      gsap.to(mat.color, { r: c.r, g: c.g, b: c.b, duration: 0.6, ease: "power2.out" });
    };
    toCol(gelA, pal.a);
    toCol(gelB, pal.b);
    toCol(gelC, pal.c);

    gsap.fromTo(
      capsuleGroup.scale,
      { x: 1, y: 1, z: 1 },
      { x: 1.04, y: 1.04, z: 1.04, yoyo: true, repeat: 1, duration: 0.18, ease: "power2.inOut" }
    );
  }

  // Update product card text based on theme
  const productTitle = document.querySelector('.product-title');
  const productCopy = document.querySelector('.product-copy');
  const productPrice = document.querySelector('.product-price');
  const productCta = document.querySelector('.sopy-product-cta');
  
  if (productTitle) {
    productTitle.textContent = theme === 'citrus' ? productTitle.getAttribute('data-citrus') : productTitle.getAttribute('data-aqua');
  }
  if (productCopy) {
    productCopy.textContent = theme === 'citrus' ? productCopy.getAttribute('data-citrus') : productCopy.getAttribute('data-aqua');
  }
  if (productPrice) {
    productPrice.textContent = theme === 'citrus' ? productPrice.getAttribute('data-citrus') : productPrice.getAttribute('data-aqua');
  }
  if (productCta) {
    productCta.textContent = theme === 'citrus' ? productCta.getAttribute('data-citrus') : productCta.getAttribute('data-aqua');
  }

  // Troca o modelo 3D para o tema
  swapModel(theme);
}
toggleBtns.forEach((btn) => {
  btn.addEventListener("click", () => {
    if (btn.classList.contains("is-active")) return;
    toggleBtns.forEach((b) => b.classList.remove("is-active"));
    btn.classList.add("is-active");
    const theme = btn.dataset.theme === "citrus" ? "citrus" : "aqua";
    setTheme(theme);
  });
});

// Toggle animado de produtos: troca tema do site
const productToggle = document.getElementById('product-toggle');
if (productToggle) {
  productToggle.addEventListener('change', function() {
    if (productToggle.checked) {
      document.body.classList.add('theme-aqua');
      document.body.classList.remove('theme-citrus');
    } else {
      document.body.classList.add('theme-citrus');
      document.body.classList.remove('theme-aqua');
    }
    // Se existir função setTheme/theme 3D, chame aqui
    if (typeof setTheme === 'function') {
      setTheme(productToggle.checked ? 'aqua' : 'citrus');
    }
  });
}

/* =========================
   BENEFÍCIOS — Cards com hover blob + animação GSAP/ScrollTrigger
   Código adicionado a pedido do usuário — roda somente se o container existir
========================= */
document.addEventListener('DOMContentLoaded', () => {
  const benefitsSection = document.getElementById('beneficios');
  if (!benefitsSection) return;

  // Hover blob follow
  const cards = benefitsSection.querySelectorAll('.card');
  cards.forEach(card => {
    const blob = card.querySelector('.card-blob');
    if (!blob) return;
    card.addEventListener('mousemove', (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      blob.style.transform = `translate(${x - (blob.clientWidth / 2)}px, ${y - (blob.clientHeight / 2)}px)`;
    });
  });

  // GSAP entrance animations (guardar presença das libs)
  try {
    if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
      if (!window.__gsapPluginsRegistered && typeof gsap.registerPlugin === 'function') {
        gsap.registerPlugin(ScrollTrigger);
        window.__gsapPluginsRegistered = true;
      }

      gsap.from("#beneficios .column:nth-child(1) .card", {
        scrollTrigger: {
          trigger: "#beneficios .cards-container",
          start: "top 80%",
          end: "center 70%",
          scrub: 0.3,
        },
        y: 50,
        x: -250,
        rotation: -20,
        opacity: 0,
        stagger: 0.2
      });

      gsap.from("#beneficios .column:nth-child(2) .card", {
        scrollTrigger: {
          trigger: "#beneficios .cards-container",
          start: "top 50%",
          end: "center 30%",
          scrub: 1,
        },
        y: 50,
        x: 250,
        rotation: 20,
        opacity: 0,
        stagger: 0.2
      });
    }
  } catch (e) {
    console.warn('Benefícios animation init failed', e);
  }
});

/* =========================
   7) Comprar (placeholder)
========================= */
document.querySelectorAll('[data-action="sopy-buy"]').forEach((btn) => {
  btn.addEventListener("click", () => {
    const card = btn.closest(".sopy-product-card");
    const sku = card?.dataset?.sku || "sopy";
    // aqui vocÃª integra com carrinho/Nuvemshop ou redireciona:
    console.log("Comprar SKU:", sku);
    gsap.fromTo(btn, { scale: 1 }, { scale: 0.96, yoyo: true, repeat: 1, duration: 0.12 });
  });
});

// Custom cursor removed: using default system cursor everywhere.

/* =========================
   9) Safety: inicia tema default
========================= */
document.body.classList.add("theme-citrus");

/* =========================
   Header: aparece no inÃ­cio e ao rolar pra cima; some ao rolar pra baixo
========================= */
(function autoHideHeader() {
  const header = document.querySelector('.site-header');
  if (!header) return;

  const showNav = () => document.body.classList.remove('nav-hidden');
  const hideNav = () => document.body.classList.add('nav-hidden');

  // VisÃ­vel no inÃ­cio (hero aberto)
  showNav();

  let lastY = 0;
  // Usamos o Lenis para obter a posiÃ§Ã£o de scroll suavizada
  lenis.on('scroll', (e) => {
    const y = e.scroll;
    // Sempre mostrar no topo da pÃ¡gina
    if (y <= 10) { showNav(); lastY = y; return; }

    const goingDown = y > lastY;
    if (goingDown) hideNav(); else showNav();
    lastY = y;
  });
})();

// Substitui o animate padrÃ£o por animateWithScroll assim que o modelo 3D estiver carregado
function start3DScrollAnimation() {
  running = true;
  if (rafId) cancelAnimationFrame(rafId);
  rafId = requestAnimationFrame(animateWithScroll);
}
// Chame start3DScrollAnimation() apÃ³s o modelo ser carregado ou fallback criado
// Exemplo: apÃ³s swapModel ou createFallbackModel, chame start3DScrollAnimation();
window.start3DScrollAnimation = start3DScrollAnimation; // para debug



/* =========================
   Footer Parallax
   Faz o footer se mover levemente pra cima enquanto entra na viewport,
   criando a impressão de que sobrepõe a seção anterior.
========================= */
(function footerParallax() {
  if (typeof gsap === 'undefined' || typeof ScrollTrigger === 'undefined') return;
  const footer = document.querySelector('.site-footer');
  if (!footer) return;

  // Inicialmente empurra o footer para baixo (para criar o movimento de subida)
  gsap.set(footer, { yPercent: 10 });

  ScrollTrigger.create({
    trigger: footer,
    start: 'top bottom', // quando o topo do footer encontra a base da viewport
    end: 'bottom top',   // até o final do footer sair do topo
    scrub: 1.2,
    invalidateOnRefresh: true,
    onUpdate: self => {
      // Normaliza progress entre 0 e 1
      const p = clamp(self.progress, 0, 1);
      // Interpola yPercent de 10 -> 0 para dar a sensação de subida
      gsap.to(footer, { yPercent: (1 - p) * 10, duration: 0.6, ease: 'power2.out' });
    }
  });
})();





    </script>

  </body>
</html>
